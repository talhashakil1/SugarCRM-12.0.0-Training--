(function(app){app.error=_.extend(app.error);function backToLogin(bDismiss){if(bDismiss)app.alert.dismissAll();app.router.login();}
function alertUser(key,title,msg){app.alert.show(key,{level:'error',title:app.lang.get(title),messages:app.lang.get(msg)});}
app.events.on('app:sync:public:error',function(error){alertUser('public_sync_failure','Unable to load the application.');});app.error.handleNeedLoginError=function(error){backToLogin(true);alertUser('needs_login_error','LBL_PORTAL_INVALID_CREDS_TITLE','LBL_PORTAL_LOGIN_UNSUCCESSFUL');};app.error.handleInvalidGrantError=function(error){backToLogin(true);alertUser("invalid_grant_error","LBL_PORTAL_INVALID_GRANT_TITLE","LBL_PORTAL_INVALID_GRANT");};app.error.handleInvalidClientError=function(error){backToLogin(true);alertUser("invalid_client_error","LBL_PORTAL_AUTH_FAILED_TITLE","LBL_PORTAL_AUTH_FAILED");};app.error.handleInvalidRequestError=function(error){backToLogin(true);alertUser("invalid_request_error","LBL_PORTAL_INVALID_REQUEST_TITLE","LBL_PORTAL_INVALID_REQUEST");};app.error.handleUnspecified400Error=function(error){app.controller.loadView({layout:'error',errorType:'400',module:'Error',create:true});};app.error.handleTimeoutError=function(error){backToLogin(true);alertUser("timeout_error","LBL_PORTAL_REQUEST_TIMEOUT_TITLE","LBL_PORTAL_REQUEST_TIMEOUT");};app.error.handleUnauthorizedError=function(error){backToLogin(true);alertUser("unauthorized_request_error","LBL_PORTAL_UNAUTHORIZED_TITLE","LBL_PORTAL_UNAUTHORIZED");};app.error.handleForbiddenError=function(error){app.alert.dismissAll();if(error.code=="portal_not_configured"){backToLogin(true);}
alertUser("forbidden_request_error","LBL_PORTAL_RESOURCE_UNAVAILABLE_TITLE",error.message?error.message:"LBL_PORTAL_RESOURCE_UNAVAILABLE");};app.error.handleNotFoundError=function(error){app.controller.loadView({layout:"error",errorType:"404",module:"Error",create:true});};app.error.handleMethodNotAllowedError=function(error){backToLogin(true);alertUser("not_allowed_error","LBL_PORTAL_METHOD_NOT_ALLOWED_TITLE","LBL_PORTAL_METHOD_NOT_ALLOWED");};app.error.handleHeaderPreconditionFailed=function(error){app.sync();};app.error.handleMethodFailureError=function(error){backToLogin(true);alertUser("precondtion_failure_error","LBL_PORTAL_PRECONDITION_MISSING_TITLE","LBL_PORTAL_PRECONDITION_MISSING");};app.error.handleServerError=function(error){app.controller.loadView({layout:"error",errorType:error.status||"500",module:"Error",error:error,create:true});};})(SUGAR.App);