(function($){var SearchAhead=function(element,options){this.options=$.extend({},$.fn.searchahead.defaults,options);this.$element=$(element);this.request=this.options.request;this.compiler=this.options.compiler;this.context=options.context||null;this.$button=this.options.buttonElement?$(this.options.buttonElement):null;this.throttle=this.options.throttle||this.throttle;this.throttleMillis=this.options.throttleMillis||this.throttleMillis;this.$menu=$(this.options.menu).appendTo(this.$element.parent().next('.typeahead-wrapper'));this.shown=false;this.minChars=this.options.minChars||1;this.patchIfZepto();this.listen();this.onEnterFn=this.options.onEnterFn||null;};SearchAhead.prototype={constructor:SearchAhead,compile:function(data){return(this.compiler({data:data,term:encodeURIComponent(this.query)}));},disabled:false,enable:function(){this.disabled=false;},disable:function(millis){var self=this;self.disabled=true;self.hide();setTimeout(function(){self.hide();},self.throttleMillis);setTimeout(function(){self.enable();},millis);},throttleMillis:250,throttle:function(callback,millis){var timerId=null;timerId=setTimeout(function(){callback();},millis);},go:function(){var activeItem=null,href=null,term=null;activeItem=this.$menu.find('.active');href=activeItem.find('a').attr('href');if(href){if(this.onEnterFn){if(this.context){this.onEnterFn.call(this.context,href,true);}else{this.onEnterFn(href,true);}}else{window.location=href;}}else{term=encodeURIComponent(this.$element.val());if(term&&term.length){if(this.onEnterFn){if(this.context){this.onEnterFn.call(this.context,term,false);}else{this.onEnterFn(term,false);}}}}
return this.hide();},show:function(){this.$menu.show();this.shown=true;if(!this.disabled){this.$menu.show();this.shown=true;return this;}
return null;},hide:function(){this.$menu.hide();this.shown=false;return this;},buttonLookup:function(evt){evt.stopPropagation();evt.preventDefault();this.lookup(evt);this.$element.focus();},lookup:function(evt){var that=this,items;this.query=this.$element.val();if(!this.query){return this.shown?this.hide():this;}
this.onSearch(evt);},onSearch:function(evt){var self=this;if($.inArray(evt.keyCode,[40,38,9,13,27])===-1){evt.preventDefault();self.throttle(function(){self.query=self.$element.val();if(self.query&&self.query.length>=self.minChars){if(self.context){self.request.call(self.context,self.query);}else{self.request(self.query);}}else{self.hide();}},self.throttleMillis);}},provide:function(data){var trimmed,markup=this.compile(data),self=this;trimmed=markup.replace(/^\s+/,'').replace(/\s+$/,'');if(trimmed.length){self.$menu.html(markup);if(!self.disabled){return self.show();}}
return null;},move:function(event,direction){var active=this.$menu.find('.active').removeClass('active'),move;if(direction==='next'){move=active.next();}else{move=active.prev();}
if(!move.length){move=$(this.$menu.find('li')[0]);}
move.addClass('active');},next:function(e){this.move(e,'next');},prev:function(e){this.move(e,'prev');},patchIfZepto:function(){if(!_.isUndefined(window.Zepto)){$.support={};$.proxy=function(fn,context){var args,tmp,proxy;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp;}
if(!$.isFunction(fn)){return undefined;}
args=Array.prototype.slice.call(arguments,2);proxy=function(){return fn.apply(context,args.concat(Array.prototype.slice.call(arguments)));};proxy.guid=fn.guid=fn.guid||proxy.guid||$.guid++;return proxy;};}},listen:function(){this.$element.on('blur',$.proxy(this.blur,this)).on('keypress',$.proxy(this.keypress,this)).on('keyup',$.proxy(this.keyup,this));if(_.some([/chrome/,/safari/,/opera\//,/webkit/,/msie/],function(rx){return rx.test(navigator.userAgent.toLowerCase());})){this.$element.on('keydown',$.proxy(this.keypress,this));}
if(this.$button){this.$button.on('click',$.proxy(this.buttonLookup,this));if(app.accessibility){app.accessibility.run(this.$button,'click');}}
this.$menu.on('mouseenter','li',$.proxy(this.mouseenter,this));},keyup:function(e){switch(e.keyCode){case 40:case 38:break;case 9:if(!this.options.tabToSelect)
break;case 13:if(this.onEnterFn){this.go();break;}
if(!this.shown)return;this.lookup(e);break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup(e);}
e.stopPropagation();e.preventDefault();},keypress:function(e){if(!this.shown)return;switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:if(e.type!=='keydown')break;e.preventDefault();this.prev();break;case 40:if(e.type!=='keydown')break;e.preventDefault();this.next();break;}
e.stopPropagation();},blur:function(e){var that=this;setTimeout(function(){that.hide();},500);},mouseenter:function(e){this.$menu.find('.active').removeClass('active');$(e.currentTarget).addClass('active');}};$.fn.searchahead=function(){var option=arguments[0],args=Array.prototype.slice.call(arguments,1);return this.each(function(){var $this=$(this),data=$this.data('searchahead'),options=typeof option==='object'&&option;if(!data){$this.data('searchahead',(data=new SearchAhead(this,options)));}
if(typeof option==='string'){data[option].apply(data,args);}});};$.fn.searchahead.defaults={items:10,menu:'<ul class="typeahead dropdown-menu"></ul>'};$.fn.searchahead.Constructor=SearchAhead;})(window.$);