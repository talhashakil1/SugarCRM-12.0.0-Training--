(function(app){app.events.on('app:init',function(){var getSystemActions=function(){var actions=[{callback:'openConfig',action:'config',name:app.lang.get('LBL_SWEETSPOT_CONFIG'),icon:'fa-cog'}];return actions;};var hasAccessToAction=function(module,action){if(module&&action.acl_action){if(!app.acl.hasAccess(action.acl_action,module)){return false;}
return action;}
if(action.acl_action==='admin'&&!app.acl.hasAccessToAny('developer')){return false;}
return action;};var getModuleLinks=function(){var actions=[];var moduleList=app.metadata.getModuleNames({filter:'display_tab',access:true});if(app.user.get('type')==='admin'&&app.metadata.getModule('Administration')){moduleList.push('Administration');moduleList=_.uniq(moduleList);}
_.each(moduleList,function(module){var moduleMeta=app.metadata.getModule(module);var menuMeta=moduleMeta&&moduleMeta.menu;var headerMeta=menuMeta&&menuMeta.header&&menuMeta.header.meta||[];var sweetspotMeta=menuMeta&&menuMeta.sweetspot&&menuMeta.sweetspot.meta||[];_.each(headerMeta.concat(sweetspotMeta),function(action){if(hasAccessToAction(action.acl_module||module,action)===false){return;}
var name;var jsFunc='push';var weight;var bwcModuleRoute='#'+app.bwc.buildRoute(module);var sidecarModuleRoute='#'+module;var isIndexRoute=action.route===sidecarModuleRoute||action.route===bwcModuleRoute;var isCreateRoute=(action.route==='#'+module+'/create');if(isIndexRoute){jsFunc='unshift';name=app.lang.getModuleName(module,{plural:true});weight=10;}else if(isCreateRoute){weight=20;name=app.lang.get(action.label,module)}else{weight=30;name=app.lang.get(action.label,module)}
var actionObj={module:module,label:app.lang.getModuleIconLabel(module),name:name,route:action.route,icon:action.icon,weight:weight,};if(action.idm_mode_link&&app.metadata.getConfig().idmModeEnabled){actionObj.route=action.idm_mode_link+'&user_hint='+encodeURIComponent(app.utils.createUserSrn(app.user.id));actionObj.openwindow=true;}
if(action.openwindow){actionObj.openwindow=action.openwindow;}
actions[jsFunc](actionObj);});});var profileActions=app.metadata.getView(null,'profileactions');_.each(profileActions,function(action){if(hasAccessToAction(action.acl_module,action)===false){return;}
var profileActionObj={name:app.lang.get(action.label),route:action.route,icon:action.icon,weight:10};if(action.openwindow){profileActionObj.openwindow=action.openwindow;}
actions.push(profileActionObj);});return actions;};app.metadata.getSweetspotActions=function(){var collection={};var actions=getModuleLinks().concat(getSystemActions());_.each(actions,function(action){if(!action.label){action.label=app.lang.getModuleIconLabel(action.name);}
collection[action.route||action.callback]=action;});return collection;};});})(SUGAR.App);