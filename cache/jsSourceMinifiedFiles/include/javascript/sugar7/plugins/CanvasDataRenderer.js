(function(app){app.events.on('app:init',function(){app.plugins.register('CanvasDataRenderer',['view'],{_scriptPath:'include/javascript/phaser/phaser-sugar.min.js',_scriptReady:false,_scriptEmbedded:false,_pageReady:false,_scriptData:undefined,onAttach:function(component,plugin){this.on('init',function(){if(window.Phaser){this._scriptEmbedded=true;this._scriptReady=true;this.context.trigger('phaserio:ready');return;}
$.ajax({type:'GET',url:this._scriptPath,dataType:'script',error:function(XMLHttpRequest,textStatus,errorThrown){console.log('[CanvasDataRenderer] Error loading file: ',errorThrown);},success:_.bind(function(data){this._scriptReady=true;this._scriptData=data;if(this._pageReady&&!this._scriptEmbedded){this.embedScript();}},this)});},null,component);this.on('render',function(){this._pageReady=true;if(this._scriptReady&&!this._scriptEmbedded){this.embedScript();}},null,component);},embedScript:function(){this._scriptEmbedded=true;if(!this.disposed){if(!window.Phaser){this.$el.prepend('<script type="text/javascript">'+this._scriptData+'</script>');}
this.context.trigger('phaserio:ready');}}});});})(SUGAR.App);