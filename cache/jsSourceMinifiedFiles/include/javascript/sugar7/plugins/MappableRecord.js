(function(app){app.events.on('app:init',function(){app.plugins.register('MappableRecord',['view'],{onAttach:function(component,plugin){this.on('init',function(){if(!app.user.hasMapsLicense()){return;}
if(!this._isModuleEnabled()){return;}
let geocodingMeta=[{'type':'rowaction','event':'button:geocoding_record:click','name':'geocoding_record','label':'LBL_MAP_GEOCODING_RECORD','acl_action':'view',},{'type':'divider',},{'type':'rowaction','event':'button:showmap:click','name':'showmap_button','label':'LBL_MAP_MAP','acl_action':'view',},{'type':'divider',},{'type':'rowaction','event':'button:directionsfromuser:click','name':'drawdirections_button','label':'LBL_MAP_DIRECTIONS_FROM_USER','acl_action':'view',},{'type':'divider',},];let dropdown=this.getRecordMainDropdown();if(_.isArray(dropdown)){dropdown.push(...geocodingMeta);this._registerGeocodingButtonEvents();}},this);},onDetach:function(component,plugin){this.context.off('button:geocoding_record:click',this.openManualGeocodingDrawer,this);this.context.off('button:directionsfromuser:click',this.showDirectionsFromUser,this);this.context.off('button:showmap:click',this.showMap,this);},_registerGeocodingButtonEvents:function(){this.context.on('button:geocoding_record:click',this.openManualGeocodingDrawer,this);this.context.on('button:directionsfromuser:click',this.showDirectionsFromUser,this);this.context.on('button:showmap:click',this.showMap,this);},openManualGeocodingDrawer:function(){app.drawer.open({layout:'maps-manual-geocoding',module:'Geocode',context:app.controller.context,});},showDirectionsFromUser:function(){app.controller.context.showDirections=true;app.drawer.open({layout:'record-map',context:app.controller.context,meta:{showDirections:true,}});},showMap:function(){app.controller.context.showDirections=false;app.drawer.open({layout:'record-map',context:app.controller.context,});},getRecordMainDropdown:function(){if(this.meta.buttons){let mainDropdown=_.filter(this.meta.buttons,function(button){return button.name==='main_dropdown';});if(_.isArray(mainDropdown)&&_.isEmpty(mainDropdown)===false){return _.first(mainDropdown).buttons;}}
return null;},_isModuleEnabled:function(){if(!_.has(app.config.maps,'enabled_modules')){return false;}
const enabledModulesKey='enabled_modules';const allowedModules=app.config.maps[enabledModulesKey];if(allowedModules.indexOf(this.module)>-1){return true;}
return false;},});});})(SUGAR.App);