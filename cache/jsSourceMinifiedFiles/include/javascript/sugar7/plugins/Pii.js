(function(app){app.events.on('app:init',function(){app.plugins.register('Pii',['view'],{_getButtonsFromMeta:function(meta){if(!_.isArray(meta.buttons)){meta.buttons=_.toArray(meta.buttons);}
return meta.buttons;},_insertViewPiiButton:function(fields){var piiFields=_.where(fields,{pii:true});if(piiFields.length>0){var actionDropDown=_.findWhere(this.meta.buttons,{type:'actiondropdown'});if(actionDropDown){var buttons=this._getButtonsFromMeta(actionDropDown);var auditButtonMeta=_.findWhere(buttons,{name:'audit_button'});var auditButtonIndex=_.indexOf(buttons,auditButtonMeta);var viewPiiButtonMeta={type:'rowaction',event:'button:view_pii_button:click',name:'view_pii_button',label:'LBL_DATAPRIVACY_VIEW_PII',acl_action:'view'};if(auditButtonIndex>-1){buttons.splice(auditButtonIndex+1,0,viewPiiButtonMeta);}else{buttons.push(viewPiiButtonMeta);}}}},onAttach:function(component,plugin){this.on('init',function(){var model=this.context.get('model')||this.model;this._insertViewPiiButton(model.fields);this.context.on('button:view_pii_button:click',this.viewPiiClicked,this);});},viewPiiClicked:function(){var context=this.context.getChildContext({name:'Pii',model:app.data.createBean('Pii')});context.set('pModule',this.module);context.set('pId',this.model.id);app.drawer.open({layout:'pii',context:context});},onDetach:function(component,plugin){this.context.off('button:view_pii_button:click',this.viewPiiClicked,this);}});});})(SUGAR.App);