var AdamFlow=function(options){jCore.Connection.call(this,options);this.flo_uid=null;this.flo_type=null;this.flo_name=null;this.flo_element_origin=null;this.flo_element_origin_type=null;this.flo_element_dest=null;this.flo_element_dest_type=null;this.flo_is_inmediate=null;this.flo_condition=null;this.flo_x1=null;this.flo_y1=null;this.flo_x2=null;this.flo_y2=null;this.flo_state=null;this.label=null;AdamFlow.prototype.initObject.call(this,options);};AdamFlow.prototype=new jCore.Connection();AdamFlow.prototype.type="Connection";AdamFlow.prototype.initObject=function(options){var defaults={flo_type:'SEQUENCE',flo_is_inmediate:true,flo_x1:0,flo_y1:0,flo_x2:0,flo_y2:0,name:''};$.extend(true,defaults,options);this.setFlowType(defaults.flo_type).setFlowUid(defaults.flo_uid).setIsInmediate(defaults.flo_is_inmediate).setOriginPoint(defaults.flo_x1,defaults.flo_y1).setTargetPoint(defaults.flo_x2,defaults.flo_y2);this.setFlowName(defaults.name||null);this.setFlowOrigin(defaults.flo_element_origin||null,defaults.flo_element_origin_type||null);this.setFlowTarget(defaults.flo_element_dest||null,defaults.flo_element_dest_type||null);this.setFlowCondition(defaults.flo_condition||null);this.setFlowState(defaults.flo_state||null);};AdamFlow.prototype.getName=function(){return this.flo_name;};AdamFlow.prototype.setName=function(name){if(name){this.flo_name=name;}
return this;};AdamFlow.prototype.getFlowCondition=function(){return this.flo_condition;};AdamFlow.prototype.setFlowUid=function(value){this.flo_uid=value;return this;};AdamFlow.prototype.setFlowType=function(type){this.flo_type=type;return this;};AdamFlow.prototype.getFlowType=function(){return this.flo_type;};AdamFlow.prototype.setIsInmediate=function(value){if(value instanceof Boolean){this.flo_is_inmediate=value;}
return this;};AdamFlow.prototype.setOriginPoint=function(x,y){this.flo_x1=x;this.flo_y1=y;return this;};AdamFlow.prototype.setTargetPoint=function(x,y){this.flo_x2=x;this.flo_y2=y;return this;};AdamFlow.prototype.setFlowName=function(name){this.flo_name=name;return this;};AdamFlow.prototype.setFlowOrigin=function(code,type){this.flo_element_origin=code;this.flo_element_origin_type=type;return this;};AdamFlow.prototype.setFlowTarget=function(code,type){this.flo_element_dest=code;this.flo_element_dest_type=type;return this;};AdamFlow.prototype.setFlowCondition=function(value){this.flo_condition=value;return this;};AdamFlow.prototype.setFlowState=function(state){this.flo_state=state;return this;};AdamFlow.prototype.setOriginShape=function(shape){var data;if(shape instanceof AdamShape){data=this.getNativeType(shape);this.flo_element_origin=data.code;this.flo_element_origin_type=data.type;}
return this;};AdamFlow.prototype.setTargetShape=function(shape){var data;if(shape instanceof AdamShape){data=this.getNativeType(shape);this.flo_element_dest=data.code;this.flo_element_dest_type=data.type;}
return this;};AdamFlow.prototype.getDBObject=function(){var typeMap={regular:'SEQUENCE',segmented:'MESSAGE',dotted:'ASSOCIATION'},state=this.getPoints();return{flo_uid:this.flo_uid,flo_type:typeMap[this.segmentStyle],flo_name:this.flo_name,flo_element_origin:this.flo_element_origin,flo_element_origin_type:this.flo_element_origin_type,flo_element_dest:this.flo_element_dest,flo_element_dest_type:this.flo_element_dest_type,flo_is_inmediate:this.flo_is_inmediate,flo_condition:this.flo_condition,flo_state:state};};AdamFlow.prototype.getNativeType=function(shape){var type=shape.getType(),code;switch(shape.getType()){case'AdamActivity':type="bpmnActivity";code=shape.act_uid;break;case'AdamGateway':type="bpmnGateway";code=shape.gat_uid;break;case'AdamEvent':type='bpmnEvent';code=shape.evn_uid;break;case'AdamArtifact':type="bpmnArtifact";code=shape.art_uid;break;}
return{"type":type,"code":code};};AdamFlow.prototype.showMoveHandlers=function(){jCore.Connection.prototype.showMoveHandlers.call(this);this.canvas.updatedElement=[{relatedObject:this}];$(this.html).trigger('selectelement');return this;};AdamFlow.prototype.getSegmentHeight=function(index){return Math.abs(this.lineSegments.get(index).endPoint.y
-this.lineSegments.get(index).startPoint.y);};AdamFlow.prototype.getSegmentWidth=function(index){return Math.abs(this.lineSegments.get(index).endPoint.x
-this.lineSegments.get(index).startPoint.x);};AdamFlow.prototype.getLabelCoordinates=function(){var x,y,index=0,diffX,diffY,i,max;max=(this.getSegmentWidth(0)>this.getSegmentHeight(0))?this.getSegmentWidth(0):this.getSegmentHeight(0);for(i=1;i<this.lineSegments.getSize();i+=1){diffX=this.getSegmentWidth(i);diffY=this.getSegmentHeight(i);if(diffX>max+1){max=diffX;index=i;}else if(diffY>max+1){max=diffY;index=i;}}
diffX=(this.lineSegments.get(index).endPoint.x
-this.lineSegments.get(index).startPoint.x)/ 2;diffY=(this.lineSegments.get(index).endPoint.y
-this.lineSegments.get(index).startPoint.y)/ 2;x=this.lineSegments.get(index).startPoint.x+diffX;y=this.lineSegments.get(index).startPoint.y+diffY;return new jCore.Point(x,y);};AdamFlow.prototype.connect=function(options){var labelPoint;jCore.Connection.prototype.connect.call(this,options);return this;};AdamFlow.prototype.changeFlowType=function(type){var segmentStyle,destDecorator,typeMap={'default':{srcPrefix:'adam-decorator_default',destPrefix:'adam-decorator'},'conditional':{srcPrefix:'adam-decorator_conditional',destPrefix:'adam-decorator'},'sequence':{srcPrefix:'adam-decorator',destPrefix:'adam-decorator'}},srcDecorator;if(type==='association'){segmentStyle="dotted";destDecorator="con-none";}else{segmentStyle="regular";}
this.setSegmentStyle(segmentStyle);this.originalSegmentStyle=segmentStyle;if(type==='association'){if(srcDecorator&&this.srcDecorator){this.srcDecorator.setDecoratorPrefix(srcDecorator);}else{this.srcDecorator.setDecoratorPrefix("adam-decorator");}
this.srcDecorator.paint();}else{this.srcDecorator.setDecoratorPrefix(typeMap[type].srcPrefix).setDecoratorType("source").paint();this.destDecorator.setDecoratorPrefix(typeMap[type].destPrefix).setDecoratorType("target").paint();this.disconnect().connect().setSegmentMoveHandlers().checkAndCreateIntersectionsWithAll();return this;}
if(destDecorator&&this.srcDecorator){this.destDecorator.setDecoratorPrefix(destDecorator);}else{this.destDecorator.setDecoratorPrefix("adam-decorator");}
this.srcDecorator.paint();this.disconnect();this.connect();return this;};AdamFlow.prototype.saveAndDestroy=function(){jCore.Connection.prototype.saveAndDestroy.call(this);if(this.getFlowType()==='DEFAULT'){this.getSrcPort().getParent().updateDefaultFlow("");}};AdamFlow.prototype.createHTML=function(){var that;if(this.html===null){that=this;jCore.Connection.prototype.createHTML.call(this);$(this.html).addClass('adam-flow').on('click','.line',function(){that.fixZIndex();$(that.destDecorator.getHTML()).trigger('click');});}
return this.html;};