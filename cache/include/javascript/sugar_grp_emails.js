function ygDDList(id,sGroup){if(id){this.init(id,sGroup);this.initFrame();}
var s=this.getDragEl().style;s.borderColor="transparent";s.backgroundColor="#f6f5e5";s.opacity=0.76;s.filter="alpha(opacity=76)";}
ygDDList.prototype=new YAHOO.util.DDProxy();ygDDList.prototype.borderDiv=null;ygDDList.prototype.originalDisplayProperties=Array();ygDDList.prototype.dashletID=null;ygDDList.prototype.needsReloadAfterDrop=false;ygDDList.prototype.startDrag=function(x,y){var dragEl=this.getDragEl();var clickEl=this.getEl();this.needsReloadAfterDrop=false;var chartContainer=YAHOO.util.Dom.getElementsByClassName('chartContainer','div',clickEl);if(chartContainer.length!=0){var cee_canvas=YAHOO.util.Dom.get(this.dashletID+'-canvas');if(typeof cee_canvas!='undefined'&&cee_canvas){var canvas_objects=YAHOO.util.Dom.getElementsBy(function(el){return true;},'OBJECT',cee_canvas);if(canvas_objects.length!=0){this.needsReloadAfterDrop=true;}}
chartContainer.innerHTML='';}
dragEl.innerHTML=clickEl.innerHTML;dragElObjects=dragEl.getElementsByTagName('object');dragEl.className=clickEl.className;dragEl.style.color=clickEl.style.color;dragEl.style.border="1px solid #aaa";clickElRegion=YAHOO.util.Dom.getRegion(clickEl);this.borderDiv=document.createElement('div');this.borderDiv.style.height=(clickElRegion.bottom-clickElRegion.top)+'px';this.borderDiv.style.border='2px dashed #cccccc';for(i in clickEl.childNodes){if(typeof clickEl.childNodes[i].style!='undefined'){this.originalDisplayProperties[i]=clickEl.childNodes[i].style.display;clickEl.childNodes[i].style.display='none';}}
clickEl.appendChild(this.borderDiv);};ygDDList.prototype.endDrag=function(e){var clickEl=this.getEl();clickEl.removeChild(this.borderDiv);for(i in clickEl.childNodes){if(typeof clickEl.childNodes[i].style!='undefined'){clickEl.childNodes[i].style.display=this.originalDisplayProperties[i];}}
if(this.clickHeight)
clickEl.style.height=this.clickHeight;else
clickEl.style.height='';if(this.clickBorder)
clickEl.style.border=this.clickBorder;else
clickEl.style.border='';dragEl=this.getDragEl();dragEl.innerHTML='';this.afterEndDrag(e);};ygDDList.prototype.afterEndDrag=function(e){}
ygDDList.prototype.onDrag=function(e,id){};ygDDList.prototype.onDragOver=function(e,id){var el;if("string"==typeof id){el=YAHOO.util.DDM.getElement(id);}else{el=YAHOO.util.DDM.getBestMatch(id).getEl();}
dragEl=this.getDragEl();elRegion=YAHOO.util.Dom.getRegion(el);var mid=YAHOO.util.DDM.getPosY(el)+(Math.floor((elRegion.bottom-elRegion.top)/ 2));if(YAHOO.util.DDM.getPosY(dragEl)<mid){var el2=this.getEl();var p=el.parentNode;p.insertBefore(el2,el);}
if(YAHOO.util.DDM.getPosY(dragEl)>=mid){var el2=this.getEl();var p=el.parentNode;p.insertBefore(el2,el.nextSibling);}};ygDDList.prototype.onDragEnter=function(e,id){};ygDDList.prototype.onDragOut=function(e,id){}
function ygDDListBoundary(id,sGroup){if(id){this.init(id,sGroup);this.isBoundary=true;}}
ygDDListBoundary.prototype=new YAHOO.util.DDTarget();
/* End of File include/javascript/yui/ygDDList.js */

(function(){if(SUGAR.EmailAddressWidget)return;var Dom=YAHOO.util.Dom;SUGAR.EmailAddressWidget=function(module){this.idmMode={disabledForModule:false,cloudConsoleUrl:''};if(!SUGAR.EmailAddressWidget.count[module])SUGAR.EmailAddressWidget.count[module]=0;this.count=SUGAR.EmailAddressWidget.count[module];SUGAR.EmailAddressWidget.count[module]++;this.module=module;this.id=this.module+this.count;if(document.getElementById(module+'_email_widget_id'))
document.getElementById(module+'_email_widget_id').value=this.id;SUGAR.EmailAddressWidget.instances[this.id]=this;}
SUGAR.EmailAddressWidget.instances={};SUGAR.EmailAddressWidget.count={};SUGAR.EmailAddressWidget.prototype={emailTemplate:'<tr id="emailAddressRow">'+'<td nowrap="NOWRAP"><input type="text" title="email address 0" name="emailAddress{$index}" id="emailAddress0" size="30"/></td>'+'<td><span>&nbsp;</span><img id="removeButton0" name="0" src="index.php?entryPoint=getImage&amp;themeName=Sugar&amp;imageName=delete_inline.gif"/></td>'+'<td align="center"><input type="radio" name="emailAddressPrimaryFlag" id="emailAddressPrimaryFlag0" value="emailAddress0" enabled="true" checked="true"/></td>'+'<td align="center"><input type="checkbox" name="emailAddressOptOutFlag[]" id="emailAddressOptOutFlag0" value="emailAddress0" enabled="true"/></td>'+'<td align="center"><input type="checkbox" name="emailAddressInvalidFlag[]" id="emailAddressInvalidFlag0" value="emailAddress0" enabled="true"/></td>'+'<td><input type="hidden" name="emailAddressVerifiedFlag0" id="emailAddressVerifiedFlag0" value="true"/></td>'+'<td><input type="hidden" name="emailAddressVerifiedValue0" id="emailAddressVerifiedValue0" value=""/></td></tr>',numberEmailAddresses:0,replyToFlagObject:new Object(),verifying:false,enterPressed:false,tabPressed:false,emailView:"",emailIsRequired:false,tabIndex:-1,prefillEmailAddresses:function(tableId,o){var primaryAddressRow=null;for(var i=0;i<o.length;i++){if(o[i].primary_address==1){primaryAddressRow=o[i];break;}}
if(!primaryAddressRow){o[0].primary_address=1;}
for(i=0;i<o.length;i++){o[i].email_address=o[i].email_address.replace('&#039;',"'");this.addEmailAddress(tableId,o[i].email_address,o[i].primary_address,o[i].reply_to_address,o[i].opt_out,o[i].invalid_email,o[i].email_address_id);}},retrieveEmailAddress:function(event){var callbackFunction=function success(data){var vals=YAHOO.lang.JSON.parse(data.responseText);var target=vals.target;event=this.getEvent(event);if(vals.email){var email=vals.email;if(email!=''&&/\d+$/.test(target)){var matches=target.match(/\d+$/);var targetNumber=matches[0];var optOutEl=Dom.get(this.id+'emailAddressOptOutFlag'+targetNumber);if(optOutEl){optOutEl.checked=email['opt_out']==1?true:false;}
var invalidEl=Dom.get(this.id+'emailAddressInvalidFlag'+targetNumber);if(invalidEl){invalidEl.checked=email['invalid_email']==1?true:false;}}}
var index=/[a-z]*\d?emailAddress(\d+)/i.exec(target)[1];var verifyElementFlag=Dom.get(this.id+'emailAddressVerifiedFlag'+index);if(verifyElementFlag.parentNode.childNodes.length>1){verifyElementFlag.parentNode.removeChild(verifyElementFlag.parentNode.lastChild);}
var verifiedTextNode=document.createElement('span');verifiedTextNode.innerHTML='';verifyElementFlag.parentNode.appendChild(verifiedTextNode);verifyElementFlag.value="true";this.verifyElementValue=Dom.get(this.id+'emailAddressVerifiedValue'+index);this.verifyElementValue.value=Dom.get(this.id+'emailAddress'+index).value;this.verifying=false;var savePressed=false;if(event){var elm=document.activeElement||event.explicitOriginalTarget;if(typeof elm.type!='undefined'&&/submit|button/.test(elm.type.toLowerCase())){if(/save|full|cancel|change/.test(elm.value.toLowerCase())){savePressed=true;}}}
if(savePressed||this.enterPressed){setTimeout("SUGAR.EmailAddressWidget.instances."+this.id+".forceSubmit()",2100);}else if(this.tabPressed){Dom.get(this.id+'emailAddressPrimaryFlag'+index).focus();}}
var event=this.getEvent(event);var targetEl=this.getEventElement(event);var index=/[a-z]*\d?emailAddress(\d+)/i.exec(targetEl.id)[1];var verifyElementFlag=Dom.get(this.id+'emailAddressVerifiedFlag'+index);if(this.verifyElementValue==null||typeof(this.verifyElementValue)=='undefined'){return false;}
this.verifyElementValue=Dom.get(this.id+'emailAddressVerifiedValue'+index);verifyElementFlag.value=(trim(targetEl.value)==''||targetEl.value==this.verifyElementValue.value)?"true":"false"
if(verifyElementFlag.parentNode.childNodes.length>1){verifyElementFlag.parentNode.removeChild(verifyElementFlag.parentNode.lastChild);}
if(/emailAddress\d+$/.test(targetEl.id)&&isValidEmailAddress(targetEl.value)&&!this.verifying&&verifyElementFlag.value=='false'){verifiedTextNode=document.createElement('span');verifyElementFlag.parentNode.appendChild(verifiedTextNode);verifiedTextNode.innerHTML=SUGAR.language.get('app_strings','LBL_VERIFY_EMAIL_ADDRESS');this.verifying=true;var cObj=YAHOO.util.Connect.asyncRequest('GET','index.php?module=Contacts&action=RetrieveEmail&target='+targetEl.id+'&email='+targetEl.value,{success:callbackFunction,failure:callbackFunction,scope:this});}},handleKeyDown:function(event){var e=this.getEvent(event);var eL=this.getEventElement(e);if((kc=e["keyCode"])){this.enterPressed=(kc==13)?true:false;this.tabPressed=(kc==9)?true:false;if(this.enterPressed||this.tabPressed){this.retrieveEmailAddress(e);if(this.enterPressed)
this.freezeEvent(e);}}},getEvent:function(event){return(event?event:window.event);},getEventElement:function(e){return(e.srcElement?e.srcElement:(e.target?e.target:e.currentTarget));},freezeEvent:function(e){if(e.preventDefault)e.preventDefault();e.returnValue=false;e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();return false;},addEmailAddress:function(tableId,address,primaryFlag,replyToFlag,optOutFlag,invalidFlag,emailId){if(this.addInProgress)
return;this.addInProgress=true;if(!address)
address="";var insertInto=Dom.get(tableId);var parentObj=insertInto.parentNode;var newContent=document.createElement("input");var nav=new String(navigator.appVersion);var newContentRecordId=document.createElement("input");var newContentPrimaryFlag=document.createElement("input");var newContentReplyToFlag=document.createElement("input");var newContentOptOutFlag=document.createElement("input");var newContentInvalidFlag=document.createElement("input");var newContentVerifiedFlag=document.createElement("input");var newContentVerifiedValue=document.createElement("input");var removeButton=document.createElement("button");var removeButtonImg=document.createElement('img');var tbody=document.createElement("tbody");var tr=document.createElement("tr");var td1=document.createElement("td");var td2=document.createElement("td");var td3=document.createElement("td");var td4=document.createElement("td");var td5=document.createElement("td");var td6=document.createElement("td");var td7=document.createElement("td");var td8=document.createElement("td");var tabIndexCount=0;if(typeof(SUGAR.TabFields)!='undefined'&&typeof(SUGAR.TabFields['email1'])!='undefined'){tabIndexCount=SUGAR.TabFields['email1'];}
newContent.setAttribute("type","text");newContent.setAttribute("name",this.id+"emailAddress"+this.numberEmailAddresses);newContent.setAttribute("id",this.id+"emailAddress"+this.numberEmailAddresses);newContent.setAttribute("tabindex",tabIndexCount);newContent.setAttribute("size","30");newContent.setAttribute("title",SUGAR.language.get('app_strings','LBL_EMAIL_TITLE'));if(this.idmMode.disabledForModule&&primaryFlag==1){newContent.setAttribute('readonly','readonly');newContent.onclick=this.showErrDismissUpdatePrimaryEmail.bind(this);}
if(address!=''){newContent.setAttribute("value",address);}
removeButtonImg.setAttribute('src',"index.php?entryPoint=getImage&themeName="+SUGAR.themes.theme_name+"&imageName=id-ff-remove-nobg.png");removeButton.setAttribute("id",this.id+"removeButton"+this.numberEmailAddresses);removeButton.setAttribute("class","id-ff-remove");removeButton.setAttribute("name",this.numberEmailAddresses);removeButton.setAttribute("type","button");removeButton.setAttribute("tabindex",tabIndexCount);removeButton.onclick=(function(eaw){return function(){eaw.removeEmailAddress(this.name);}})(this);removeButton.appendChild(removeButtonImg);newContentRecordId.setAttribute("type","hidden");newContentRecordId.setAttribute("name",this.id+"emailAddressId"+this.numberEmailAddresses);newContentRecordId.setAttribute("id",this.id+"emailAddressId"+this.numberEmailAddresses);newContentRecordId.setAttribute("value",typeof(emailId)!='undefined'?emailId:'');newContentRecordId.setAttribute("enabled","true");newContentPrimaryFlag.setAttribute("type","radio");newContentPrimaryFlag.setAttribute("name",this.id+"emailAddressPrimaryFlag");newContentPrimaryFlag.setAttribute("id",this.id+"emailAddressPrimaryFlag"+this.numberEmailAddresses);newContentPrimaryFlag.setAttribute("value",this.id+"emailAddress"+this.numberEmailAddresses);newContentPrimaryFlag.setAttribute("enabled","true");newContentPrimaryFlag.setAttribute("tabindex",tabIndexCount);newContentReplyToFlag.setAttribute("type","radio");newContentReplyToFlag.setAttribute("name",this.id+"emailAddressReplyToFlag");newContentReplyToFlag.setAttribute("id",this.id+"emailAddressReplyToFlag"+this.numberEmailAddresses);newContentReplyToFlag.setAttribute("value",this.id+"emailAddress"+this.numberEmailAddresses);newContentReplyToFlag.setAttribute("enabled","true");newContentReplyToFlag.setAttribute("tabindex",tabIndexCount);newContentReplyToFlag.eaw=this;newContentReplyToFlag['onclick']=function(){var form=document.forms[this.eaw.emailView];if(!form){form=document.forms['editContactForm'];}
var nav=new String(navigator.appVersion);if(nav.match(/MSIE/gim)){for(i=0;i<form.elements.length;i++){var id=new String(form.elements[i].id);if(id.match(/emailAddressReplyToFlag/gim)&&form.elements[i].type=='radio'&&id!=this.eaw.id){form.elements[i].checked=false;}}}
for(i=0;i<form.elements.length;i++){var id=new String(form.elements[i].id);if(id.match(/emailAddressReplyToFlag/gim)&&form.elements[i].type=='radio'&&id!=this.eaw.id){this.eaw.replyToFlagObject[this.eaw.id]=false;}}
if(this.eaw.replyToFlagObject[this.id]){this.eaw.replyToFlagObject[this.id]=false;this.checked=false;}else{this.eaw.replyToFlagObject[this.id]=true;this.checked=true;}}
newContentOptOutFlag.setAttribute("type","checkbox");newContentOptOutFlag.setAttribute("name",this.id+"emailAddressOptOutFlag[]");newContentOptOutFlag.setAttribute("id",this.id+"emailAddressOptOutFlag"+this.numberEmailAddresses);newContentOptOutFlag.setAttribute("value",this.id+"emailAddress"+this.numberEmailAddresses);newContentOptOutFlag.setAttribute("enabled","true");newContentOptOutFlag.eaw=this;newContentOptOutFlag.setAttribute("tabindex",tabIndexCount);newContentOptOutFlag['onClick']=function(){this.eaw.toggleCheckbox(this)};newContentInvalidFlag.setAttribute("type","checkbox");newContentInvalidFlag.setAttribute("name",this.id+"emailAddressInvalidFlag[]");newContentInvalidFlag.setAttribute("id",this.id+"emailAddressInvalidFlag"+this.numberEmailAddresses);newContentInvalidFlag.setAttribute("value",this.id+"emailAddress"+this.numberEmailAddresses);newContentInvalidFlag.setAttribute("enabled","true");newContentInvalidFlag.eaw=this;newContentInvalidFlag.setAttribute("tabindex",tabIndexCount);newContentInvalidFlag['onClick']=function(){this.eaw.toggleCheckbox(this);};newContentVerifiedFlag.setAttribute("type","hidden");newContentVerifiedFlag.setAttribute("name",this.id+"emailAddressVerifiedFlag"+this.numberEmailAddresses);newContentVerifiedFlag.setAttribute("id",this.id+"emailAddressVerifiedFlag"+this.numberEmailAddresses);newContentVerifiedFlag.setAttribute("value","true");newContentVerifiedValue.setAttribute("type","hidden");newContentVerifiedValue.setAttribute("name",this.id+"emailAddressVerifiedValue"+this.numberEmailAddresses);newContentVerifiedValue.setAttribute("id",this.id+"emailAddressVerifiedValue"+this.numberEmailAddresses);newContentVerifiedValue.setAttribute("value",address);newContentVerifiedValue.setAttribute("tabindex",tabIndexCount);this.emailView=(this.emailView=='')?'EditView':this.emailView;addToValidateVerified(this.emailView,this.id+"emailAddressVerifiedFlag"+this.numberEmailAddresses,'bool',false,SUGAR.language.get('app_strings','LBL_VERIFY_EMAIL_ADDRESS'));tr.setAttribute("id",this.id+"emailAddressRow"+this.numberEmailAddresses);td1.setAttribute("nowrap","NOWRAP");td3.setAttribute("align","center");td4.setAttribute("align","center");td5.setAttribute("align","center");td6.setAttribute("align","center");td1.appendChild(newContent);td1.appendChild(newContentRecordId);td1.appendChild(document.createTextNode(" "));spanNode=document.createElement('span');spanNode.innerHTML='&nbsp;';td2.appendChild(spanNode);if(this.numberEmailAddresses!=0||typeof(this.emailIsRequired)=="undefined"||!this.emailIsRequired)
td2.appendChild(removeButton);if(this.idmMode.disabledForModule){newContentPrimaryFlag.setAttribute('disabled','disabled');if(primaryFlag==1){var primaryRadioHidden=document.createElement('input');primaryRadioHidden.setAttribute('name',newContentPrimaryFlag.name);primaryRadioHidden.setAttribute('type','hidden');primaryRadioHidden.value=newContentPrimaryFlag.value;td3.appendChild(primaryRadioHidden);td3.appendChild(newContentPrimaryFlag);}}else{td3.appendChild(newContentPrimaryFlag);}
td4.appendChild(newContentReplyToFlag);td5.appendChild(newContentOptOutFlag);td6.appendChild(newContentInvalidFlag);td7.appendChild(newContentVerifiedFlag);td8.appendChild(newContentVerifiedValue);tr.appendChild(td1);tr.appendChild(td2);tr.appendChild(td3);if(typeof(this.module)!='undefined'&&this.module=='Users'){tr.appendChild(td4);}else{tr.appendChild(td5);tr.appendChild(td6);}
tr.appendChild(td7);tr.appendChild(td8);tbody.appendChild(tr);insertInto.appendChild(tbody);parentObj.insertBefore(Dom.get('targetBody'),insertInto);if(primaryFlag=='1'||(this.numberEmailAddresses==0)){newContentPrimaryFlag.setAttribute("checked",'true');newContent.setAttribute("title",SUGAR.language.get('app_strings','LBL_EMAIL_PRIM_TITLE'));}
if(replyToFlag=='1'){newContentReplyToFlag.setAttribute("checked","true");}
if(replyToFlag=='1'){this.replyToFlagObject[newContentReplyToFlag.id]=true;}else{this.replyToFlagObject[newContentReplyToFlag.id]=false;}
if(optOutFlag=='1'){newContentOptOutFlag.setAttribute("checked",'true');newContent.setAttribute("title",SUGAR.language.get('app_strings','LBL_EMAIL_OPT_TITLE'));}
if(invalidFlag=='1'){newContentInvalidFlag.setAttribute("checked","true");newContent.setAttribute("title",SUGAR.language.get('app_strings','LBL_EMAIL_INV_TITLE'));}
newContent.eaw=this;newContent.onblur=function(e){this.eaw.retrieveEmailAddress(e)};newContent.onkeydown=function(e){this.eaw.handleKeyDown(e)};if(YAHOO.env.ua.ie>0){var emailcontainer=Dom.getAncestorByTagName(insertInto,'span');YAHOO.util.Event.addListener(newContent,"change",function(ev,el){SUGAR.util.callOnChangeListers(el);},emailcontainer);}
this.EmailAddressValidation(this.emailView,this.id+'emailAddress'+this.numberEmailAddresses,this.emailIsRequired,SUGAR.language.get('app_strings','LBL_EMAIL_ADDRESS_BOOK_EMAIL_ADDR'));var form=Dom.getAncestorByTagName(insertInto,"form");if(SUGAR.forms.AssignmentHandler.VARIABLE_MAP[form.name])
SUGAR.forms.AssignmentHandler.registerForm(form.name,form);this.numberEmailAddresses++;this.addInProgress=false;},EmailAddressValidation:function(ev,fn,r,stR){YAHOO.util.Event.onContentReady(fn,function(){addToValidate(ev,fn,'email',r,stR);});},removeEmailAddress:function(index){if(this.idmMode.disabledForModule&&Dom.get(this.id+'emailAddressPrimaryFlag'+index)){return this.showErrDismissUpdatePrimaryEmail();}
removeFromValidate(this.emailView,this.id+'emailAddress'+index);var oNodeToRemove=Dom.get(this.id+'emailAddressRow'+index);var form=Dom.getAncestorByTagName(oNodeToRemove,"form");oNodeToRemove.parentNode.removeChild(oNodeToRemove);var removedIndex=parseInt(index);if(this.numberEmailAddresses!=removedIndex){for(var x=removedIndex+1;x<this.numberEmailAddresses;x++){Dom.get(this.id+'emailAddress'+x).setAttribute("name",this.id+"emailAddress"+(x-1));Dom.get(this.id+'emailAddress'+x).setAttribute("id",this.id+"emailAddress"+(x-1));if(Dom.get(this.id+'emailAddressInvalidFlag'+x)){Dom.get(this.id+'emailAddressInvalidFlag'+x).setAttribute("value",this.id+"emailAddress"+(x-1));Dom.get(this.id+'emailAddressInvalidFlag'+x).setAttribute("id",this.id+"emailAddressInvalidFlag"+(x-1));}
if(Dom.get(this.id+'emailAddressOptOutFlag'+x)){Dom.get(this.id+'emailAddressOptOutFlag'+x).setAttribute("value",this.id+"emailAddress"+(x-1));Dom.get(this.id+'emailAddressOptOutFlag'+x).setAttribute("id",this.id+"emailAddressOptOutFlag"+(x-1));}
if(Dom.get(this.id+'emailAddressPrimaryFlag'+x)){Dom.get(this.id+'emailAddressPrimaryFlag'+x).setAttribute("id",this.id+"emailAddressPrimaryFlag"+(x-1));}
Dom.get(this.id+'emailAddressVerifiedValue'+x).setAttribute("id",this.id+"emailAddressVerifiedValue"+(x-1));Dom.get(this.id+'emailAddressVerifiedFlag'+x).setAttribute("id",this.id+"emailAddressVerifiedFlag"+(x-1));var rButton=Dom.get(this.id+'removeButton'+x);rButton.setAttribute("name",(x-1));rButton.setAttribute("id",this.id+"removeButton"+(x-1));Dom.get(this.id+'emailAddressRow'+x).setAttribute("id",this.id+'emailAddressRow'+(x-1));}}
this.numberEmailAddresses--;if(this.numberEmailAddresses==0){return;}
var primaryFound=false;for(x=0;x<this.numberEmailAddresses;x++){if(Dom.get(this.id+'emailAddressPrimaryFlag'+x).checked){primaryFound=true;}}
if(!primaryFound){Dom.get(this.id+'emailAddressPrimaryFlag0').checked=true;Dom.get(this.id+'emailAddressPrimaryFlag0').value=this.id+'emailAddress0';}
if(SUGAR.forms.AssignmentHandler.VARIABLE_MAP[form.name])
SUGAR.forms.AssignmentHandler.registerForm(form.name,form);},showErrDismissUpdatePrimaryEmail:function(){var label=parent.SUGAR.App.user.get('type')=='admin'?'ERR_UPDATE_PERSON_PRIMARY_EMAIL_IN_IDM_MODE_ADMIN':'ERR_UPDATE_PERSON_PRIMARY_EMAIL_IN_IDM_MODE';parent.SUGAR.App.alert.show('dismiss_delete_primary_email',{level:'info',messages:SUGAR.language.get('app_strings',label).replace('{0}',this.idmMode.cloudConsoleUrl)});},toggleCheckbox:function(el){var form=document.forms[this.emailView];if(!form){form=document.forms['editContactForm'];}
if(YAHOO.env.ua.ie){for(i=0;i<form.elements.length;i++){var id=new String(form.elements[i].id);if(id.match(/emailAddressInvalidFlag/gim)&&form.elements[i].type=='checkbox'&&id!=el.id){form.elements[i].checked=false;}}
el.checked=true;}},forceSubmit:function(){var theForm=Dom.get(this.emailView);if(theForm){theForm.action.value='Save';if(!check_form(this.emailView)){return false;}
if(this.emailView=='EditView'){theForm.submit();}else if(this.emailView.indexOf('DCQuickCreate')>0){DCMenu.save(theForm.id);}else if(this.emailView.indexOf('QuickCreate')>=0){SUGAR.subpanelUtils.inlineSave(theForm.id,theForm.module.value+'_subpanel_save_button');}}}};emailAddressWidgetLoaded=true;})();
/* End of File include/SugarEmailAddress/SugarEmailAddress.js */

if(typeof(SUGAR.collection)=="undefined"){SUGAR.collection=function(form_name,field_name,module,popupData){this.more_status=false;this.form=form_name;this.field=field_name;this.field_element_name=this.form+'_'+this.field;this.module=module;this.fields_count=0;this.extra_fields_count=0;this.first=true;this.primary_field="";this.cloneField=new Array();this.sqs_clone="";this.secondaries_values=new Array();this.update_fields=new Object();this.show_more_image=true;};SUGAR.collection.prototype={remove:function(num){var radio_els=this.get_radios();var div_el;if(radio_els.length==1){div_el=document.getElementById(this.field_element_name+'_input_div_'+num);var input_els=div_el.getElementsByTagName('input');input_els[0].value='';input_els[1].value='';if(this.primary_field){div_el=document.getElementById(this.field_element_name+'_radio_div_'+num);radio_els=div_el.getElementsByTagName('input');radio_els[0].checked=false;}}else{div_el=document.getElementById(this.field_element_name+'_input_div_'+num);if(!div_el)
div_el=document.getElementById(this.field_element_name+'_radio_div_'+num);var tr_to_remove=document.getElementById('lineFields_'+this.field_element_name+'_'+num);div_el.parentNode.parentNode.parentNode.removeChild(tr_to_remove);var div_id='lineFields_'+this.field_element_name+'_'+num;if(typeof sqs_objects[div_id.replace("_field_","_")]!='undefined'){delete(sqs_objects[div_id.replace("_field_","_")]);}
var checked=false;for(var k=0;k<radio_els.length;k++){if(radio_els[k].checked){checked=true;}}
var primary_checked=document.forms[this.form].elements[this.field+"_allowed_to_check"];var allowed_to_check=true;if(primary_checked&&primary_checked.value=='false'){allowed_to_check=false;}
if(/EditView/.test(this.form)&&!checked&&typeof radio_els[0]!='undefined'&&allowed_to_check){radio_els[0].checked=true;this.changePrimary(true);this.js_more();this.js_more();}
if(radio_els.length==1){this.more_status=false;if(document.getElementById('more_'+this.field_element_name)&&document.getElementById('more_'+this.field_element_name).style.display!='none'){document.getElementById('more_'+this.field_element_name).style.display='none';}
this.show_arrow_label(false);this.js_more();}else{this.js_more();this.js_more();}}},get_radios:function(){return YAHOO.util.Selector.query('input[name^=primary]',document.getElementById(this.field_element_name+'_table'));},add:function(values){this.fields_count++;var Field0=this.init_clone(values);this.cloneField[1].appendChild(Field0);enableQS(true);this.changePrimary(false);if(document.getElementById('more_'+this.field_element_name)&&document.getElementById('more_'+this.field_element_name).style.display=='none'){document.getElementById('more_'+this.field_element_name).style.display='';}
if(!this.is_expanded()){this.js_more();this.show_arrow_label(true);}},add_secondaries:function(){var clone_id=this.form+'_'+this.field+'_collection_0';YAHOO.util.Event.onContentReady(clone_id,function(c){c.create_clone();enableQS();c.changePrimary(true);for(key in c.secondaries_values){if(isInteger(key)){c.add(c.secondaries_values[key]);}}
c.js_more();if(!_.isUndefined(window.parent.SUGAR)&&!_.isUndefined(window.parent.SUGAR.App.view)){window.parent.SUGAR.App.controller.layout.getComponent('bwc').revertBwcModel();}},this);},init_clone:function(values){if(typeof this.cloneField[0]=='undefined'){return;}
if(typeof values=="undefined"){values=new Array();values['name']="";values['id']="";values['selected']='';}
var count=this.fields_count;var Field0=SUGAR.isIE?SUGAR.collection.safe_clone(this.cloneField[0],true):this.cloneField[0].cloneNode(true);Field0.id="lineFields_"+this.field_element_name+"_"+count;for(var ii=0;ii<Field0.childNodes.length;ii++){if(typeof(Field0.childNodes[ii].tagName)!='undefined'&&Field0.childNodes[ii].tagName=="TD"){for(var jj=0;jj<Field0.childNodes[ii].childNodes.length;jj++){currentNode=Field0.childNodes[ii].childNodes[jj];this.process_node(Field0.childNodes[ii],currentNode,values);}}}
return Field0;},process_node:function(parentNode,currentNode,values){if(parentNode.className=='td_extra_field'){if(parentNode.id){parentNode.id='';}
var toreplace=this.field+"_collection_extra_0";var re=new RegExp(toreplace,'g');parentNode.innerHTML=parentNode.innerHTML.replace(re,this.field+"_collection_extra_"+this.fields_count);}else if(currentNode.tagName&&currentNode.tagName=='SPAN'){if(/_input/.test(currentNode.id)){currentNode.id=this.field_element_name+'_input_div_'+this.fields_count;}else{if(/_radio_div_/.test(currentNode.id)){currentNode.id=this.field_element_name+'_radio_div_'+this.fields_count;}else{currentNode.id=this.field_element_name+'_checkbox_div_'+this.fields_count;}}
if(/_input/.test(currentNode.id)){currentNode.name='teamset_div';}
var input_els=currentNode.getElementsByTagName('input');for(var x=0;x<input_els.length;x++){if(typeof(input_els[x].id)=='undefined'||input_els[x].id==''){input_els[x].id=currentNode.id;}
if(input_els[x].tagName&&input_els[x].tagName=='INPUT'){this.process_node(parentNode,input_els[x],values);}}}else if(currentNode.name){var toreplace=this.field+"_collection_0";var re=new RegExp(toreplace,'g');var name=currentNode.name;var new_name=name.replace(re,this.field+"_collection_"+this.fields_count);var new_id=currentNode.id.replace(re,this.field+"_collection_"+this.fields_count);switch(name){case toreplace:var sqs_id=this.form+'_'+new_name;if(typeof this.sqs_clone!='undefined'){var sqs_clone=YAHOO.lang.JSON.stringify(this.sqs_clone);sqs_objects[sqs_id]=JSON.parse(sqs_clone);for(var pop_field in sqs_objects[sqs_id]['populate_list']){if(typeof sqs_objects[sqs_id]['populate_list'][pop_field]=='string'){sqs_objects[sqs_id]['populate_list'][pop_field]=sqs_objects[sqs_id]['populate_list'][pop_field].replace(RegExp('_0','g'),"_"+this.fields_count);}}
for(var req_field in sqs_objects[sqs_id]['required_list']){if(typeof sqs_objects[sqs_id]['required_list'][req_field]=='string'){sqs_objects[sqs_id]['required_list'][req_field]=sqs_objects[sqs_id]['required_list'][req_field].replace(RegExp('_0','g'),"_"+this.fields_count);}}}
currentNode.name=new_name;currentNode.id=new_id;currentNode.value=values['name'];break;case"id_"+toreplace:currentNode.name=new_name.replace(RegExp('_0','g'),"_"+this.fields_count);currentNode.id=new_id.replace(RegExp('_0','g'),"_"+this.fields_count);currentNode.value=values['id'];break;case"btn_"+toreplace:currentNode.name=new_name;currentNode.attributes['onclick'].value=currentNode.attributes['onclick'].value.replace(re,this.field+"_collection_"+this.fields_count);currentNode.attributes['onclick'].value=currentNode.attributes['onclick'].value.replace(RegExp(this.field+"_collection_extra_0",'g'),this.field+"_collection_extra_"+this.fields_count);break;case"allow_new_value_"+toreplace:currentNode.name=new_name;currentNode.id=new_id;break;case"remove_"+toreplace:currentNode.name=new_name;currentNode.id=new_id;currentNode.setAttribute('collection_id',this.field_element_name);currentNode.setAttribute('remove_id',this.fields_count);currentNode.onclick=function(){collection[this.getAttribute('collection_id')].remove(this.getAttribute('remove_id'));};break;case"primary_"+this.field+"_collection":currentNode.id=new_id;currentNode.value=this.fields_count;currentNode.checked=false;currentNode.setAttribute('defaultChecked','');break;case"selected_"+toreplace:currentNode.name=new_name.replace(RegExp('_0','g'),"_"+this.fields_count);currentNode.id=new_id.replace(RegExp('_0','g'),"_"+this.fields_count);if(this.form!=='MassUpdate'){currentNode.value=values['id'];}
if(values.selected){currentNode.setAttribute('checked','checked');}else{currentNode.removeAttribute('checked');}
break;default:alert(toreplace+'|'+currentNode.name+'|'+name+'|'+new_name);break;}}},js_more:function(val){if(this.show_more_image){var more_=document.getElementById('more_img_'+this.field_element_name);var arrow=document.getElementById('arrow_'+this.field);var radios=this.get_radios();if(this.more_status==false){more_.src="index.php?entryPoint=getImage&themeName="+SUGAR.themes.theme_name+"&imageName=advanced_search.gif";this.more_status=true;var hidden_count=0;for(var k=0;k<radios.length;k++){if(radios[k].type&&radios[k].type=='radio'){if(radios[k].checked){radios[k].parentNode.parentNode.parentNode.style.display='';}else{radios[k].parentNode.parentNode.parentNode.style.display='none';hidden_count++;}}}
if(hidden_count==radios.length){radios[0].parentNode.parentNode.parentNode.style.display='';}
arrow.value='hide';}else{more_.src="index.php?entryPoint=getImage&themeName="+SUGAR.themes.theme_name+"&imageName=basic_search.gif";this.more_status=false;for(var k=0;k<radios.length;k++){if(isInteger(k)){radios[k].parentNode.parentNode.parentNode.style.display='';}}
arrow.value='show';}
if(!_.isUndefined(window.parent.SUGAR)&&!_.isUndefined(window.parent.SUGAR.App.view)){var model=window.parent.SUGAR.App.controller.layout.getComponent('bwc').bwcModel;model.set($(arrow).attr('name'),arrow.value);}
var more_div=document.getElementById('more_div_'+this.field_element_name);if(more_div){more_div.innerHTML=arrow.value=='show'?SUGAR.language.get('app_strings','LBL_HIDE'):SUGAR.language.get('app_strings','LBL_SHOW');if(radios.length==1){more_div.parentNode.parentNode.style.display='none';}else{more_div.parentNode.parentNode.style.display='';}}}},create_clone:function(){var oneField=document.getElementById('lineFields_'+this.field_element_name+'_0');this.cloneField[0]=SUGAR.isIE?SUGAR.collection.safe_clone(oneField,true):oneField.cloneNode(true);this.cloneField[1]=oneField.parentNode;var clone_id=this.form+'_'+this.field+'_collection_0';if(typeof sqs_objects!='undefined'&&typeof sqs_objects[clone_id]!='undefined'){var clone=YAHOO.lang.JSON.stringify(sqs_objects[clone_id]);this.sqs_clone=JSON.parse(clone);}},validateTemSet:function(formname,fieldname){var table_element_id=formname+'_'+fieldname+'_table';if(document.getElementById(table_element_id)){var input_elements=YAHOO.util.Selector.query('input[type=radio]',document.getElementById(table_element_id));var has_primary=false;var primary_field_id=fieldname+'_collection_0';for(t in input_elements){primary_field_id=fieldname+'_collection_'+input_elements[t].value;if(input_elements[t].type&&input_elements[t].type=='radio'&&input_elements[t].checked==true){if(document.forms[formname].elements[primary_field_id].value!=''){has_primary=true;}
break;}}
if(!has_primary){return false;}
return true;}
return true;},getTeamIdsfromUI:function(formname,fieldname){var team_ids=new Array();var table_element_id=formname+'_'+fieldname+'_table';if(document.getElementById(table_element_id)){input_elements=YAHOO.util.Selector.query('input[type=hidden]',document.getElementById(table_element_id));for(t=0;t<input_elements.length;t++){if(input_elements[t].id.match(fieldname+"_collection_")!=null){team_ids.push(input_elements[t].value);}}}
return team_ids;},getPrimaryTeamidsFromUI:function(formname,fieldname){var table_element_id=formname+'_'+fieldname+'_table';if(document.getElementById(table_element_id)){var input_elements=YAHOO.util.Selector.query('input[type=radio]',document.getElementById(table_element_id));for(t in input_elements){var primary_field_id='id_'+document.forms[formname][fieldname].name+'_collection_'+input_elements[t].value;if(input_elements[t].type&&input_elements[t].type=='radio'&&input_elements[t].checked==true){if(document.forms[formname].elements[primary_field_id].value!=''){return document.forms[formname].elements[primary_field_id].value;}}}}
return'';},getSelectedTeamIdsFromUI:function(formname,fieldname){var team_ids=[];var table_element_id=formname+'_'+fieldname+'_table';if(document.getElementById(table_element_id)){var inputElements=YAHOO.util.Selector.query('input[type=hidden][name^=id_'+fieldname+']',document.getElementById(table_element_id));var checkboxes=YAHOO.util.Selector.query('input[type=checkbox]',document.getElementById(table_element_id));for(var t=0;t<checkboxes.length;t++){if($(checkboxes[t]).prop('checked')&&checkboxes[t].id.match("selected_"+fieldname+"_collection_")!=null){team_ids.push(inputElements[t].value);}}}
return team_ids;},changePrimary:function(noAdd){var old_primary=this.primary_field;var radios=this.get_radios();for(var k=0;k<radios.length;k++){var qs_id=radios[k].id.replace('primary_','');if(radios[k].checked){this.primary_field=qs_id;}else{qs_id=qs_id+'_'+k;}
qs_id=this.form+'_'+qs_id;if(typeof sqs_objects!='undefined'&&typeof sqs_objects[qs_id]!='undefined'&&sqs_objects[qs_id]['primary_field_list']){for(var ii=0;ii<sqs_objects[qs_id]['primary_field_list'].length;ii++){if(radios[k].checked&&qs_id!=old_primary){sqs_objects[qs_id]['field_list'].push(sqs_objects[qs_id]['primary_field_list'][ii]);sqs_objects[qs_id]['populate_list'].push(sqs_objects[qs_id]['primary_populate_list'][ii]);}else if(old_primary==qs_id&&!radios[k].checked){sqs_objects[qs_id]['field_list'].pop();sqs_objects[qs_id]['populate_list'].pop();}}}}
if(noAdd){enableQS(false);}
this.first=false;},js_more_detail:function(id){var more_img=document.getElementById('more_img_'+id);if(more_img.style.display=='inline'){more_img.src="index.php?entryPoint=getImage&themeName="+SUGAR.themes.theme_name+"&imageName=advanced_search.gif";}else{more_img.src="index.php?entryPoint=getImage&themeName="+SUGAR.themes.theme_name+"&imageName=basic_search.gif";}},replace_first:function(values){for(var i=0;i<=this.fields_count;i++){var div_el=document.getElementById(this.field_element_name+'_input_div_'+i);if(div_el){var name_field=document.getElementById(this.field_element_name+"_collection_"+i);var id_field=document.getElementById("id_"+this.field_element_name+"_collection_"+i);name_field.value=values['name'];id_field.value=values['id'];break;}}},clean_up:function(){var divsToClean=new Array();var isFirstFieldEmpty=false;var divCount=0;for(var i=0;i<=this.fields_count;i++){var div_el=document.getElementById(this.field_element_name+'_input_div_'+i);if(div_el){input_els=div_el.getElementsByTagName('input');for(var x=0;x<input_els.length;x++){if(input_els[x].id&&input_els[x].name==(this.field+'_collection_'+i)&&trim(input_els[x].value)==''){if(divCount==0){isFirstFieldEmpty=true;}else{divsToClean.push(i);}}}
divCount++;}}
for(var j=0;j<divsToClean.length;j++){this.remove(divsToClean[j]);}
return isFirstFieldEmpty;},show_arrow_label:function(show){var more_div=document.getElementById('more_div_'+this.field_element_name);if(more_div){more_div.parentNode.parentNode.style.display=show?'':'none';}},is_expanded:function(){var more_div=document.getElementById('more_div_'+this.field_element_name);if(more_div){return more_div.parentNode.parentNode.style.display=='';}
return false;}};SUGAR.collection.safe_clone=function(e,recursive){if(e.nodeName=="#text"){return document.createTextNode(e.data);}
if(!e.tagName)return false;var newNode=document.createElement(e.tagName);if(!newNode)return false;var properties=['id','class','style','name','type','valign','border','width','height','top','bottom','left','right','scope','row','columns','src','href','className','align','nowrap'];if(SUGAR.isIE7&&e.tagName.toLowerCase()=='input'){var properties=['id','class','style','name','type','valign','border','width','top','bottom','left','right','scope','row','columns','src','href','className','align','nowrap'];}
for(var i in properties){if(e[properties[i]]){if((properties[i]!='style'||!SUGAR.isIE)&&(properties[i]!='href'||e.tagName=='a'||e.tagName=='iframe')){if(properties[i]=="type"){newNode.setAttribute(properties[i],e[properties[i]]);}else{newNode[properties[i]]=e[properties[i]];}}}}
if(recursive){for(var i in e.childNodes){if(e.childNodes[i].nodeName&&(!e.className||e.className!="yui-ac-container")){var child=SUGAR.collection.safe_clone(e.childNodes[i],true);if(child)newNode.appendChild(child);}}}
return newNode;}}
/* End of File include/SugarFields/Fields/Collection/SugarFieldCollection.js */

SUGAR.routing={actions:new Object(),rules:new Object(),strings:new Object(),editRule:function(id){this.xhr.startRequest(callback.editRule,this.xhr.urlStandard+"&routingAction=getRule&rule_id="+id+"&bean=InboundEmail");},removeRule:function(id){alert('implement SUGAR.routing.removeRule() pls.');},getStrings:function(){this.xhr.startRequest(callback.strings,this.xhr.urlStandard+"&routingAction=getStrings");},getDependentDropdowns:function(){this.xhr.startRequest(callback.dd,this.xhr.urlStandard+"&routingAction=getActions");}}
SUGAR.routing.handleDependentDropdown=function(el,focusDD){if(SUGAR.dependentDropdown.debugMode)SUGAR.dependentDropdown.utils.debugStack('handleDependentDropdown');var index=el.id.slice(el.id.indexOf("::")+2,el.id.indexOf(":::"));var actionIndex=index / 100;var elementRow=el.parentNode;var elementIndex=el.id.slice(el.id.indexOf(":::")+3,el.id.indexOf(":-:"));SUGAR.dependentDropdown.currentAction=SUGAR.routing.rules.InboundEmail[SUGAR.routing.currentRuleId][focusDD][actionIndex];elementIndex++;var elementKey="element"+elementIndex;var focusElement=SUGAR.dependentDropdown.dropdowns[focusDD].elements[elementKey];if(focusElement){if(focusElement.handlers){try{focusElement=focusElement.handlers[el.value];}catch(e){if(SUGAR.dependentDropdown.dropdowns.debugMode){debugger;}}}
SUGAR.dependentDropdown.generateElement(focusElement,elementRow,index,elementIndex);}}
SUGAR.routing.utils={removeChildren:function(el){for(i=el.childNodes.length-1;i>=0;i--){if(el.childNodes[i]){el.removeChild(el.childNodes[i]);}}}}
SUGAR.routing.xhr={currentRequestObject:null,timeout:30000,forceAbort:false,trail:new Array(),urlStandard:'sugar_body_only=true&to_pdf=true&module=Emails&action=SugarRoutingAsync',_reset:function(){this.timeout=30000;this.forceAbort=false;},startRequest:function(callback,args,forceAbort){if(this.currentRequestObject!=null){if(this.forceAbort==true){YAHOO.util.Connect.abort(this.currentRequestObject,null,false);}}
this.currentRequestObject=YAHOO.util.Connect.asyncRequest('POST',"./index.php",callback,args);this._reset();},handleFailure:function(o){SUGAR.showMessageBox('Exception occurred...',o.statusText);debugger;},fillStrings:function(o){var ret=YAHOO.lang.JSON.parse(o.responseText);SUGAR.routing.strings=ret.strings;SUGAR.routing.matchDom=ret.matchDom;SUGAR.routing.matchTypeDom=ret.matchTypeDom;SUGAR.routing.actions=ret.actions;},displayFetchedRule:function(o){var ret=YAHOO.lang.JSON.parse(o.responseText);SUGAR.routing.ui.displayRule(ret);},fillDependentDropdowns:function(o){var ret=YAHOO.lang.JSON.parse(o.responseText);SUGAR.dependentDropdown.dropdowns=ret;},saveRule:function(formId){if(SUGAR.routing.ui.checkRule(formId)){SUGAR.showMessageBox(SUGAR.routing.strings.LBL_ROUTING_SAVING_RULE,SUGAR.routing.strings.LBL_ROUTING_ONE_MOMENT);var values=YAHOO.util.Connect.setForm(document.getElementById(formId));this.startRequest(callback.saveRule,SUGAR.routing.urlStandard);}},deleteRule:function(rule_id){this.startRequest(callback.saveRule,this.urlStandard+"&routingAction=deleteRule&rule_id="+rule_id);},getComposeCache:function(){this.startRequest(callback.fillComposeCache,'sugar_body_only=true&to_pdf=true&module=Emails&action=EmailUIAjax&emailUIAction=fillComposeCache');},fillComposeCache:function(o){var ret=YAHOO.lang.JSON.parse(o.responseText);SUGAR.email2.composeLayout.emailTemplates=ret.emailTemplates;SUGAR.email2.composeLayout.signatures=ret.signatures;return SUGAR.email2.composeLayout.emailTemplates;},setRuleStatusCleanup:function(o){}}
SUGAR.routing.ui={deleteRule:function(rule_id){if(confirm(SUGAR.routing.strings.LBL_ROUTING_CONFIRM_DELETE)){SUGAR.routing.xhr.deleteRule(rule_id);}},displayRule:function(ret){if(!SUGAR.routing.rules[ret.bean]){SUGAR.routing.rules[ret.bean]=new Object();}
if(!SUGAR.routing.rules[ret.bean][ret.rule.id]){SUGAR.routing.rules[ret.bean][ret.rule.id]=new Object();}
SUGAR.routing.rules[ret.bean][ret.rule.id]=ret.rule;SUGAR.routing.currentRuleId=ret.rule.id;var d=document.getElementById("rulesDetailsCell");SUGAR.routing.utils.removeChildren(d);d.style.padding='5px';YAHOO.ext.DomHelper.append(d,{tag:'form',name:'routingForm'+ret.rule.id,id:'routingRule'+ret.rule.id,method:'post'});var form=document.getElementById('routingRule'+ret.rule.id);YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'bean',value:ret.bean});YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'sugar_body_only',value:'true'});YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'to_pdf',value:'true'});YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'module',value:'Emails'});YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'action',value:'SugarRoutingAsync'});YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'routingAction',value:'saveRule'});YAHOO.ext.DomHelper.append(form,{tag:'input',type:'hidden',name:'id',value:ret.rule.id});var save="SUGAR.routing.xhr.saveRule('"+"routingRule"+ret.rule.id+"');";YAHOO.ext.DomHelper.append(form,{tag:'input',type:'button',cls:'button',onclick:save,value:"   "+SUGAR.routing.strings.LBL_ROUTING_BUTTON_SAVE+"   "});form.innerHTML+="&nbsp;";YAHOO.ext.DomHelper.append(form,{tag:'input',type:'button',cls:'button',onclick:'SUGAR.routing.ui.cancelRule();',value:"   "+SUGAR.routing.strings.LBL_ROUTING_BUTTON_CANCEL+"   "});form.innerHTML+="<br />&nbsp;<br />";var tmp=YAHOO.ext.DomHelper.append(form,{tag:'div',cls:'routingInputField',html:SUGAR.routing.strings.LBL_ROUTING_NAME+": &nbsp;"},true);var nameDiv=tmp.dom;YAHOO.ext.DomHelper.append(nameDiv,{tag:'input',type:'text',name:'name',id:'ruleName',value:ret.rule.name,size:'32',cls:'input'});YAHOO.ext.DomHelper.append(form,{tag:"br"});var tmp=YAHOO.ext.DomHelper.append(form,{tag:'div',cls:'routingInputField'},true);var matchDiv=tmp.dom;matchDiv.innerHTML+=SUGAR.routing.strings.LBL_ROUTING_MATCH+"&nbsp;";var tmp=YAHOO.ext.DomHelper.append(matchDiv,{tag:'select',name:'all',cls:'select'},true);var matchDropDown=tmp.dom;matchDropDown.options[0]=new Option(SUGAR.routing.strings.LBL_ROUTING_ANY,0);matchDropDown.options[1]=new Option(SUGAR.routing.strings.LBL_ROUTING_ALL,1,ret.rule.all);matchDiv.innerHTML+="&nbsp;"+SUGAR.routing.strings.LBL_ROUTING_MATCH_2+"&nbsp;";YAHOO.ext.DomHelper.append(form,{tag:"br"});var tmp=YAHOO.ext.DomHelper.append(form,{tag:'div',id:'routingCriteria'},true);for(var i=0;i<ret.rule.criteria.length;i++){var index=i*100;SUGAR.routing.ui.generateRuleCondition(tmp.dom,ret.rule.criteria[i],index);}
form.innerHTML+="<br />";var tmp=YAHOO.ext.DomHelper.append(form,{tag:'div',style:'padding-top:10px;'},true);var actionDiv=tmp.dom;actionDiv.innerHTML+=SUGAR.routing.strings.LBL_ROUTING_ACTIONS_PEFORM+":<br />&nbsp;<br />";for(var i=0;i<ret.rule.actions.length;i++){var index=i*100;SUGAR.routing.ui.generateRuleAction(actionDiv,ret.rule.actions[i],index);}},getElementValues:function(type){switch(type){case"move_mail":return SUGAR.email2.folders.getAvailableFoldersObject();break;case"email_templates":if(!SUGAR.email2.composeLayout.emailTemplates){SUGAR.routing.xhr.getComposeCache();setTimeout("SUGAR.routing.ui.getElementValues('email_templates');",2000);}else{return SUGAR.email2.composeLayout.emailTemplates;}
break;}},generateRuleAction:function(container,criteria,index){this.generateRuleRow(container,criteria,index,'Action');},generateRuleCondition:function(container,criteria,index){this.generateRuleRow(container,criteria,index,'Rule');},generateRuleRow:function(container,criteria,index,type){var elementIndex=0;var theme='Sugar';if(container.id.match(/Row/i)){var tmp=YAHOO.ext.DomHelper.insertAfter(container,{tag:'div',cls:'routing'+type,style:'padding:2px;',id:'routing'+type+'Row'+index},true);}else{var tmp=YAHOO.ext.DomHelper.append(container,{tag:'div',cls:'routing'+type,style:'padding:2px;',id:'routing'+type+'Row'+index},true);}
var ruleRow=tmp.dom;var remove="javascript:SUGAR.routing.ui.removeCriteria('routing"+type+"Row"+index+"');";var minus=YAHOO.ext.DomHelper.append(ruleRow,{tag:'a',href:remove},true);YAHOO.ext.DomHelper.append(minus.dom,{tag:'img',src:'index.php?entryPoint=getImage&themeName='+SUGAR.themes.theme_name+'&imageName=minus.gif',border:0,cls:'img'},false);ruleRow.innerHTML+="&nbsp;";var insert="javascript:SUGAR.routing.ui.insertCriteria('routing"+type+"Row"+index+"');";var plus=YAHOO.ext.DomHelper.append(ruleRow,{tag:'a',href:insert},true);YAHOO.ext.DomHelper.append(plus.dom,{tag:'img',src:'index.php?entryPoint=getImage&themeName='+SUGAR.themes.theme_name+'&imageName=plus.gif',border:0,cls:'img'},false);ruleRow.innerHTML+="&nbsp;";SUGAR.dependentDropdown.currentAction=criteria;var ddType=(type=='Rule')?'criteria':'actions';for(var elementKey in SUGAR.dependentDropdown.dropdowns[ddType].elements){var focusElement=SUGAR.dependentDropdown.dropdowns[ddType].elements[elementKey];SUGAR.dependentDropdown.generateElement(focusElement,ruleRow,index,elementIndex);if(!focusElement.force_render||focusElement.force_render==''){return;}else{elementIndex++;}}},insertCriteria:function(clickElement){var row=document.getElementById(clickElement);var focusRowIndex=parseFloat(clickElement.substr(clickElement.search(/\d/)));if(row.nextSibling){var nextRow=row.nextSibling;var nextRowIndex=parseFloat(nextRow.id.substr(nextRow.id.search(/\d/)));var insertIndex=((nextRowIndex-focusRowIndex)/ 2)+focusRowIndex;}else{var insertIndex=focusRowIndex+100;}
if(row.id.match(/Action/)){this.generateRuleAction(row,{},insertIndex);}else{this.generateRuleCondition(row,{},insertIndex);}},cancelRule:function(){SUGAR.routing.utils.removeChildren(document.getElementById("rulesDetailsCell"));},addRule:function(){ret={bean:'InboundEmail',rule:{id:'',name:'',criteria:[{action:{'crit0':'name','crit1':'match','crit2':''}}],actions:[{action:{'action0':'move_mail','action1':''}}]}};SUGAR.routing.ui.displayRule(ret);},removeCriteria:function(id){var bucket=document.getElementById(id);SUGAR.routing.utils.removeChildren(bucket);bucket.parentNode.removeChild(bucket);},setRuleStatus:function(cb){var status=(cb.checked)?'enable':'disable';var id=cb.value;SUGAR.routing.xhr.startRequest(callback.setRuleStatus,SUGAR.routing.xhr.urlStandard+"&routingAction=setRuleStatus&rule_id="+id+"&status="+status);}}
SUGAR.routing.ui.checkRule=function(formId){SUGAR.routing.ui.errors=new Array();var ret=true;var form=document.getElementById(formId);var el=null;var v=null;for(var i=0;i<form.elements.length;i++){el=form.elements[i];if(el.type!='hidden'&&el.type!='button'){if(el.type=='text'){if(el.value==""){SUGAR.routing.ui.errors.push(el.id);ret=false;}}else if(el.type=='select'||el.type=='select-one'){var v=el.options[el.selectedIndex].value;if(v=='-1'||v=='-2'||v=='_break'||v.match(/spacer/ig)){SUGAR.routing.ui.errors.push(el.id);ret=false;}}
if(el.style.border&&(el.style.border=='1px solid rgb(255, 0, 0)'||el.style.border=='#f00 1px solid')){el.style.border='1px solid #090';el.className='input';}}}
if(!ret){SUGAR.showMessageBox(SUGAR.routing.strings.LBL_ROUTING_CHECK_RULE,SUGAR.routing.strings.LBL_ROUTING_CHECK_RULE_DESC);for(var j=0;j<SUGAR.routing.ui.errors.length;j++){var focusEl=document.getElementById(SUGAR.routing.ui.errors[j]);if(focusEl)
focusEl.style.border="1px solid #f00";}}
return ret;}
callback={failure:SUGAR.routing.xhr.handleFailure,timeout:SUGAR.routing.xhr.timeout,scope:SUGAR.routing.xhr,editRule:{success:SUGAR.routing.xhr.displayFetchedRule,failure:this.failure,timeout:this.timeout,scope:this.scope},strings:{success:SUGAR.routing.xhr.fillStrings,failure:this.failure,timeout:this.timeout,scope:this.scope},example:{success:SUGAR.routing.xhr.handleSuccess,failure:this.failure,timeout:this.timeout,scope:this.scope},dd:{success:SUGAR.routing.xhr.fillDependentDropdowns,failure:this.failure,timeout:this.timeout,scope:this.scope},saveRule:{success:function(){SUGAR.hideMessageBox();SUGAR.routing.ui.cancelRule();AjaxObject.startRequest(callbackLoadRules,urlStandard+"&emailUIAction=loadRulesForSettings");},failure:this.failure,timeout:this.timeout,scope:this.scope},fillComposeCache:{success:SUGAR.routing.xhr.fillComposeCache,failure:this.failure,timeout:this.timeout,scope:this.scope},setRuleStatus:{success:SUGAR.routing.xhr.setRuleStatusCleanup,failure:this.failure,timeout:this.timeout,scope:this.scope}}
/* End of File include/SugarRouting/javascript/SugarRouting.js */

SUGAR.dependentDropdown={currentAction:null,debugMode:false}
SUGAR.dependentDropdown.handleDependentDropdown=function(el){}
SUGAR.dependentDropdown.generateElement=function(focusElement,elementRow,index,elementIndex){if(SUGAR.dependentDropdown.debugMode)SUGAR.dependentDropdown.utils.debugStack('generateElement');var tmp=null;if(focusElement){var sandbox=SUGAR.dependentDropdown.utils.generateElementContainer(focusElement,elementRow,index,elementIndex);if(focusElement.label){focusLabel={tag:'span',cls:'routingLabel',html:"&nbsp;"+focusElement.label+"&nbsp;"}
switch(focusElement.label_pos){case"top":focusLabel.html=focusElement.label+"<br />";break;case"bottom":focusLabel.html="<br />"+focusElement.label;break;}
if(focusElement.label_pos=='left'||focusElement.label_pos=='top'){YAHOO.ext.DomHelper.append(sandbox,focusLabel);}}
switch(focusElement.type){case'input':if(typeof(focusElement.values)=='string'){focusElement.values=JSON.parse(focusElement.values);}
var preselect=SUGAR.dependentDropdown.utils.getPreselectKey(focusElement.name);if(preselect.match(/::/))
preselect='';tmp=YAHOO.ext.DomHelper.append(sandbox,{tag:'input',id:focusElement.grouping+"::"+index+":::"+elementIndex+":-:"+focusElement.id,name:focusElement.grouping+"::"+index+"::"+focusElement.name,cls:'input',onchange:focusElement.onchange,value:preselect},true);var newElement=tmp.dom;break;case'select':tmp=YAHOO.ext.DomHelper.append(sandbox,{tag:'select',id:focusElement.grouping+"::"+index+":::"+elementIndex+":-:"+focusElement.id,name:focusElement.grouping+"::"+index+"::"+focusElement.name,cls:'input',onchange:focusElement.onchange},true);var newElement=tmp.dom;if(typeof(focusElement.values)=='string'){focusElement.values=eval(focusElement.values);}
var preselect=SUGAR.dependentDropdown.utils.getPreselectKey(focusElement.name);var i=0;for(var key in focusElement.values){var selected=(preselect==key)?true:false;newElement.options[i]=new Option(focusElement.values[key],key,selected);if(selected){newElement.options[i].selected=true;}
i++;}
break;case'none':break;case'checkbox':alert('implement checkbox pls');break;case'multiple':alert('implement multiple pls');break;default:if(SUGAR.dependentDropdown.dropdowns.debugMode){alert("Improper type defined: [ "+focusElement.type+"]");}
return;break;}
if(focusElement.label){if(focusElement.label_pos=='right'||focusElement.label_pos=='bottom'){YAHOO.ext.DomHelper.append(sandbox,focusLabel);}}
try{newElement.onchange();}catch(e){if(SUGAR.dependentDropdown.dropdowns.debugMode){debugger;}}}}
SUGAR.dependentDropdown.utils={generateElementContainer:function(focusElement,elementRow,index,elementIndex){var oldElement=document.getElementById('elementContainer'+focusElement.grouping+"::"+index+":::"+elementIndex);if(oldElement){SUGAR.dependentDropdown.utils.removeChildren(oldElement);}
var tmp=YAHOO.ext.DomHelper.append(elementRow,{tag:'span',id:'elementContainer'+focusElement.grouping+"::"+index+":::"+elementIndex},true);return tmp.dom;},getPreselectKey:function(elementName){try{if(SUGAR.dependentDropdown.currentAction.action[elementName]){return SUGAR.dependentDropdown.currentAction.action[elementName];}else{return'';}}catch(e){if(SUGAR.dependentDropdown.dropdowns.debugMode){}
return'';}},debugStack:function(func){if(!SUGAR.dependentDropdown._stack){SUGAR.dependentDropdown._stack=new Array();}
SUGAR.dependentDropdown._stack.push(func);},removeChildren:function(el){for(i=el.childNodes.length-1;i>=0;i--){if(el.childNodes[i]){el.removeChild(el.childNodes[i]);}}}}
/* End of File include/SugarDependentDropdown/javascript/SugarDependentDropdown.js */

SUGAR.inboundEmail={};Rot13={map:null,convert:function(a){Rot13.init();var s="";for(i=0;i<a.length;i++){var b=a.charAt(i);s+=((b>='A'&&b<='Z')||(b>='a'&&b<='z')?Rot13.map[b]:b);}
return s;},init:function(){if(Rot13.map!=null)
return;var map=new Array();var s="abcdefghijklmnopqrstuvwxyz";for(i=0;i<s.length;i++)
map[s.charAt(i)]=s.charAt((i+13)%26);for(i=0;i<s.length;i++)
map[s.charAt(i).toUpperCase()]=s.charAt((i+13)%26).toUpperCase();Rot13.map=map;},write:function(a){return Rot13.convert(a);}}
function getEncryptedPassword(login,password,mailbox){var words=new Array(login,password,mailbox);for(i=0;i<3;i++){word=words[i];if(word.indexOf('&')>0){fragment1=word.substr(0,word.indexOf('&'));fragment2=word.substr(word.indexOf('&')+1,word.length);newWord=fragment1+'::amp::'+fragment2;words[i]=newWord;word=newWord;fragment1='';fragment2='';}
if(word.indexOf('+')>0){fragment1=word.substr(0,word.indexOf('+'));fragment2=word.substr(word.indexOf('+')+1,word.length);newWord=fragment1+'::plus::'+fragment2;words[i]=newWord;word=newWord;fragment1='';fragment2='';}
if(word.indexOf('%')>0){fragment1=word.substr(0,word.indexOf('%'));fragment2=word.substr(word.indexOf('%')+1,word.length);newWord=fragment1+'::percent::'+fragment2;words[i]=newWord;word=newWord;fragment1='';fragment2='';}}
return words;}
function close_ie_test_popup(){SUGAR.inboundEmail.ie_test_popup_dialog.hide();}
function ie_test_open_popup_with_submit(module_name,action,pageTarget,width,height,mail_server,protocol,port,login,password,mailbox,ssl,personal,formName,ie_id,eapm_id){if(!formName)formName="testSettingsView";var words=getEncryptedPassword(login,password,mailbox);var isPersonal=(personal)?'true':'false';if(!isDataValid(formName,true)){return;}
if(typeof(ie_id)=='undefined'||ie_id=='')
ie_id=(typeof document.getElementById(formName).ie_id!='undefined')?document.getElementById(formName).ie_id.value:'';URL='index.php?'
+'module='+module_name
+'&to_pdf=1'
+'&action='+action
+'&target='+pageTarget
+'&target1='+pageTarget
+'&server_url='+mail_server
+'&email_user='+words[0]
+'&protocol='+protocol
+'&port='+port
+'&email_password='+encodeURIComponent(words[1])
+'&mailbox='+words[2]
+'&ssl='+ssl
+'&ie_id='+ie_id
+'&personal='+isPersonal
+'&eapm_id='+eapm_id;var SI=SUGAR.inboundEmail;if(!SI.testDlg){SI.testDlg=new YAHOO.widget.SimpleDialog("testSettingsDiv",{width:width+"px",draggable:true,dragOnly:true,close:true,constraintoviewport:true,modal:true,loadingText:SUGAR.language.get("app_strings","LBL_EMAIL_LOADING")});SI.testDlg._updateContent=function(o){var w=this.cfg.config.width.value+"px";this.setBody(o.responseText);if(this.evalJS)
SUGAR.util.evalScript(o.responseText);if(!SUGAR.isIE)
this.body.style.width=w
SUGAR.inboundEmail.ie_test_popup_dialog=this;window.setTimeout(function(){close_ie_test_popup()},3000);}}
var title=SUGAR.language.get('Emails','LBL_TEST_SETTINGS');if(typeof(title)=="undefined"||title=="undefined")
title=SUGAR.language.get('InboundEmail','LBL_TEST_SETTINGS');SI.testDlg.setHeader(title);SI.testDlg.setBody(SUGAR.language.get("app_strings","LBL_EMAIL_LOADING"));SI.testDlg.render(document.body);var Connect=YAHOO.util.Connect;if(Connect.url)URL=Connect.url+"&"+url;Connect.asyncRequest("POST",URL,{success:SI.testDlg._updateContent,failure:SI.testDlg.hide,scope:SI.testDlg});SI.testDlg.show();}
function isDataValid(formName,validateMonitoredFolder){var formObject=document.getElementById(formName);var errors=new Array();var out=new String();if(trim(formObject.server_url.value)==""){errors.push(SUGAR.language.get('app_strings','LBL_EMAIL_ERROR_SERVER'));}
if(trim(formObject.email_user.value)==""){errors.push(SUGAR.language.get('app_strings','LBL_EMAIL_ERROR_USER'));}
if(formObject.protocol.protocol==""){errors.push(SUGAR.language.get('app_strings','LBL_EMAIL_ERROR_PROTOCOL'));}
if(formObject.protocol.value=='imap'&&validateMonitoredFolder){if(trim(formObject.mailbox.value)==""){errors.push(SUGAR.language.get('app_strings','LBL_EMAIL_ERROR_MONITORED_FOLDER'));}}
if(formObject.port.value==""){errors.push(SUGAR.language.get('app_strings','LBL_EMAIL_ERROR_PORT'));}
if(errors.length>0){out=SUGAR.language.get('app_strings','LBL_EMAIL_ERROR_DESC');for(i=0;i<errors.length;i++){if(out!=""){out+="\n";}
out+=errors[i];}
alert(out);return false;}else{return true;}}
function getFoldersListForInboundAccount(moduleName,action,pageTarget,width,height,mailServer,protocol,port,login,password,mailbox,ssl,personal,searchFieldValue,formName,eapmId){if(!formName)formName="testSettingsView";var words=getEncryptedPassword(login,password,mailbox);var isPersonal=(personal)?'true':'false';var url='index.php?'+'module='+moduleName+'&to_pdf=1'+'&action='+action+'&target='+pageTarget+'&target1='+pageTarget+'&server_url='+mailServer+'&eapm_id='+eapmId+'&email_user='+words[0]+'&protocol='+protocol+'&port='+port+'&email_password='+encodeURIComponent(words[1])+'&mailbox='+words[2]+'&ssl='+ssl+'&personal='+isPersonal+'&searchField='+searchFieldValue;var SI=SUGAR.inboundEmail;if(!SI.listDlg){SI.listDlg=new YAHOO.widget.SimpleDialog("selectFoldersDiv",{width:width+"px",draggable:true,dragOnly:true,close:true,constraintoviewport:true,modal:true,loadingText:SUGAR.language.get("app_strings","LBL_EMAIL_LOADING")});SI.listDlg._updateContent=function(o){var w=this.cfg.config.width.value+"px";this.setBody(o.responseText);SUGAR.util.evalScript(o.responseText);if(!SUGAR.isIE)
this.body.style.width=w}}
SI.listDlg.setHeader(SUGAR.language.get("app_strings","LBL_EMAIL_LOADING"));SI.listDlg.setBody('');SI.listDlg.render(document.body);var Connect=YAHOO.util.Connect;if(Connect.url){url=Connect.url+'&'+url;}
Connect.asyncRequest('POST',url,{success:SI.listDlg._updateContent,failure:SI.listDlg.hide,scope:SI.listDlg});SI.listDlg.show();}
function setPortDefault(){var prot=document.getElementById('protocol');var ssl=document.getElementById('ssl');var port=document.getElementById('port');var stdPorts=new Array("110","143","993","995");var stdBool=new Boolean(false);if(port.value==''){stdBool.value=true;}else{for(i=0;i<stdPorts.length;i++){if(stdPorts[i]==port.value){stdBool.value=true;}}}
if(stdBool.value==true){if(prot.value=='imap'&&ssl.checked==false){port.value="143";}else if(prot.value=='imap'&&ssl.checked==true){port.value='993';}else if(prot.value=='pop3'&&ssl.checked==false){port.value='110';}else if(prot.value=='pop3'&&ssl.checked==true){port.value='995';}}}
function toggle_monitored_folder(field){var field1=document.getElementById('protocol');var mailbox=document.getElementById('mailbox');var label_inbox=document.getElementById('label_inbox');var subscribeFolderButton=document.getElementById('subscribeFolderButton');var trashFolderRow=document.getElementById('trashFolderRow');var trashFolderRow1=document.getElementById('trashFolderRow1');var sentFolderRow=document.getElementById('sentFolderRow');var sentFolderRow1=document.getElementById('sentFolderRow1');var mailboxRow=document.getElementById('mailboxRow');var mailboxRow1=document.getElementById('mailboxRow1');if(field1.value=='imap'){mailbox.disabled=false;try{mailbox.style.display='';trashFolderRow.style.display='';sentFolderRow.style.display='';trashFolderRow1.style.display='';subscribeFolderButton.style.display='';sentFolderRow1.style.display='';mailboxRow.style.display='';mailboxRow1.style.display='';}catch(e){};label_inbox.style.display='';}
else{mailbox.value="INBOX";mailbox.disabled=false;try{mailbox.style.display="none";trashFolderRow.style.display="none";sentFolderRow.style.display="none";trashFolderRow1.style.display="none";subscribeFolderButton.style.display='none';sentFolderRow1.style.display='none';mailboxRow.style.display='none';mailboxRow1.style.display='none';}catch(e){};label_inbox.style.display="none";}}
/* End of File modules/InboundEmail/InboundEmail.js */

function enableQS(noReload){YAHOO.util.Event.onDOMReady(function(){if(typeof sqs_objects=='undefined'){return;}
var Dom=YAHOO.util.Dom;var qsFields=Dom.getElementsByClassName('sqsEnabled');for(var qsField in qsFields){if(typeof qsFields[qsField]=='function'||typeof qsFields[qsField].id=='undefined'){continue;}
var form_id=qsFields[qsField].form.getAttribute('id');if(typeof form_id=='object'&&qsFields[qsField].form.getAttribute('real_id')){form_id=qsFields[qsField].form.getAttribute('real_id');}
var qs_index_id=form_id+'_'+qsFields[qsField].name;if(typeof sqs_objects[qs_index_id]=='undefined'){qs_index_id=qsFields[qsField].name;if(typeof sqs_objects[qs_index_id]=='undefined'){continue;}}
if(QSProcessedFieldsArray[qs_index_id]){skipSTR='collection_0';if(qs_index_id.lastIndexOf(skipSTR)!=(qs_index_id.length-skipSTR.length)){continue;}}
var qs_obj=sqs_objects[qs_index_id];var loaded=false;if(!document.forms[qs_obj.form]){continue;}
if(!document.forms[qs_obj.form].elements[qsFields[qsField].id].readOnly&&qs_obj['disable']!=true){var combo_id=qs_obj.form+'_'+qsFields[qsField].id;if(Dom.get(combo_id+"_results")){loaded=true}
if(!loaded){QSProcessedFieldsArray[qs_index_id]=true;qsFields[qsField].form_id=form_id;var sqs=sqs_objects[qs_index_id];var resultDiv=document.createElement('div');resultDiv.id=combo_id+"_results";Dom.insertAfter(resultDiv,qsFields[qsField]);var fields=qs_obj.field_list.slice();fields[fields.length]="module";var ds=new YAHOO.util.DataSource("index.php?",{responseType:YAHOO.util.XHRDataSource.TYPE_JSON,responseSchema:{resultsList:'fields',total:'totalCount',fields:fields,metaNode:"fields",metaFields:{total:'totalCount',fields:"fields"}},connMethodPost:true});var forceSelect=!((qsFields[qsField].form&&typeof(qsFields[qsField].form)=='object'&&qsFields[qsField].form.name=='search_form')||qsFields[qsField].className.match('sqsNoAutofill')!=null);var search=new YAHOO.widget.AutoComplete(qsFields[qsField],resultDiv,ds,{typeAhead:forceSelect,forceSelection:forceSelect,fields:fields,sqs:sqs,animSpeed:0.25,qs_obj:qs_obj,inputElement:qsFields[qsField],generateRequest:function(sQuery){var item_id=this.inputElement.form_id+'_'+this.inputElement.name;if(QSCallbacksArray[item_id]){QSCallbacksArray[item_id](this.sqs);}
var out=SUGAR.util.paramsToUrl({to_pdf:'true',module:'Home',action:'quicksearchQuery',data:YAHOO.lang.JSON.stringify(this.sqs),query:sQuery});return out;},setFields:function(data,filter){this.updateFields(data,filter);},updateFields:function(data,filter){for(var i in this.fields){for(var key in this.qs_obj.field_list){if(this.fields[i]==this.qs_obj.field_list[key]&&document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]&&this.qs_obj.populate_list[key].match(filter)){var displayValue=data[i].replace(/&amp;/gi,'&').replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&#039;/gi,'\'').replace(/&quot;/gi,'"');document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]].value=displayValue;SUGAR.util.callOnChangeListers(document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]);}}}
SUGAR.util.callOnChangeListers(this._elTextbox);},clearFields:function(){for(var key in this.qs_obj.field_list){if(document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]){document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]].value="";SUGAR.util.callOnChangeListers(document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]);}}
this.oldValue="";}});if(/^(billing_|shipping_)?account_name$/.exec(qsFields[qsField].name)){search.clearFields=function(){for(var i in{name:0,id:1}){for(var key in this.qs_obj.field_list){if(i==this.qs_obj.field_list[key]&&document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]){document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]].value="";}}}};search.setFields=function(data,filter){var label_str='';var label_data_str='';var current_label_data_str='';var label_data_hash=new Array();for(var i in this.fields){for(var key in this.qs_obj.field_list){if(this.fields[i]==this.qs_obj.field_list[key]&&document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]&&document.getElementById(this.qs_obj.populate_list[key]+'_label')&&this.qs_obj.populate_list[key].match(filter)){var displayValue=data[i].replace(/&amp;/gi,'&').replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&#039;/gi,'\'').replace(/&quot;/gi,'"');var data_label=document.getElementById(this.qs_obj.populate_list[key]+'_label').innerHTML.replace(/\n/gi,'').replace(/<\/?[^>]+(>|$)/g,"");label_and_data=data_label+' '+displayValue;if(document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]]&&!label_data_hash[data_label]){label_str+=data_label+' \n';label_data_str+=label_and_data+'\n';label_data_hash[data_label]=true;current_label_data_str+=data_label+' '+document.forms[this.qs_obj.form].elements[this.qs_obj.populate_list[key]].value+'\n';}}}}
if(label_str!=current_label_data_str&&current_label_data_str!=label_data_str){module_key=(typeof document.forms[form_id].elements['module']!='undefined')?document.forms[form_id].elements['module'].value:'app_strings';warning_label=SUGAR.language.translate(module_key,'NTC_OVERWRITE_ADDRESS_PHONE_CONFIRM')+'\n\n'+label_data_str;if(!confirm(warning_label)){this.updateFields(data,/account_id/);}else{if(Dom.get('shipping_checkbox')){if(this.inputElement.id=='shipping_account_name'){filter=Dom.get('shipping_checkbox').checked?/(account_id|office_phone)/:filter;}else if(this.inputElement.id=='billing_account_name'){filter=Dom.get('shipping_checkbox').checked?filter:/(account_id|office_phone|billing)/;}}else if(Dom.get('alt_checkbox')){filter=Dom.get('alt_checkbox').checked?filter:/^(?!alt)/;}
this.updateFields(data,filter);}}else{this.updateFields(data,filter);}};}
search.itemSelectEvent.subscribe(function(e,args){var data=args[2];var fields=this.fields;this.setFields(data,/\S/);if(typeof(this.qs_obj['post_onblur_function'])!='undefined'){collection_extended=new Array();for(var i in fields){for(var key in this.qs_obj.field_list){if(fields[i]==this.qs_obj.field_list[key]){collection_extended[this.qs_obj.field_list[key]]=data[i];}}}
eval(this.qs_obj['post_onblur_function']+'(collection_extended, this.qs_obj.id)');}});search.textboxFocusEvent.subscribe(function(){this.oldValue=this.getInputEl().value;});search.selectionEnforceEvent.subscribe(function(e,args){if(this.oldValue!=args[1]){this.clearFields();}else{this.getInputEl().value=this.oldValue;}});search.dataReturnEvent.subscribe(function(e,args){if(this.getInputEl().value.length==0&&args[2].length>0){var data=[];for(var key in this.qs_obj.field_list){data[data.length]=args[2][0][this.qs_obj.field_list[key]];}
this.getInputEl().value=data[this.key];this.itemSelectEvent.fire(this,"",data);}});search.typeAheadEvent.subscribe(function(e,args){this.getInputEl().value=this.getInputEl().value.replace(/&amp;/gi,'&').replace(/&lt;/gi,'<').replace(/&gt;/gi,'>').replace(/&#039;/gi,'\'').replace(/&quot;/gi,'"');});if(SUGAR.isIE&&navigator.appVersion.match(/MSIE (.\..)/)[1]<8&&/team_name/.test(search.getInputEl().id)){search.containerExpandEvent.subscribe(function(e,args){var zVal=9999;div_els=YAHOO.util.Selector.query('div[name=teamset_div]');for(x in div_els){Dom.setStyle(div_els[x],'z-index',zVal--);Dom.setStyle(div_els[x],'position','relative');}});}
if(typeof QSFieldsArray[combo_id]=='undefined'&&qsFields[qsField].id){QSFieldsArray[combo_id]=search;}}}}});}
function registerSingleSmartInputListener(input){if((c=input.className)&&(c.indexOf("sqsEnabled")!=-1)){enableQS(true);}}
if(typeof QSFieldsArray=='undefined'){QSFieldsArray=new Array();QSProcessedFieldsArray=new Array();QSCallbacksArray=new Array();}
/* End of File include/javascript/quicksearch.js */

